<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<PGMExchangeFile>
	<fileHeader company="Schneider Automation" product="Unity Pro XL V12.0 - 170404A" dateTime="date_and_time#2022-5-17-16:49:17" content="Fichero fuente de multi programa" DTDVersion="41"></fileHeader>
	<contentHeader name="Proyecto" version="0.0.463" dateTime="date_and_time#2022-5-17-14:54:46"></contentHeader>
	<logicConf>
		<resource resName="Micro Basic" resIdent="BMX P34 2020 02.70">
			<taskDesc task="MAST" taskType="cyclic" valueType="0" maxExecTime="250">
				<sectionDesc name="SECCION_PRIMER_CICLO" SectionOrder="1"></sectionDesc>
				<sectionDesc name="SECCION_SINCRONIZAR_RELOJ" SectionOrder="2"></sectionDesc>
				<sectionDesc name="SECCION_TEST_ENLACE" SectionOrder="3"></sectionDesc>
				<sectionDesc name="SECCION_COMUNICACION_TEST_ENLACE" SectionOrder="4"></sectionDesc>
				<sectionDesc name="SECCION_METER_SACAR_DE_COLA" SectionOrder="5"></sectionDesc>
				<sectionDesc name="SECCION_BUF_SAL_COLA_A_LECTURA" SectionOrder="6"></sectionDesc>
				<sectionDesc name="SECCION_CARGAR_DAT_PRIMER_CICLO" SectionOrder="7"></sectionDesc>
				<sectionDesc name="SECCION_DIRECCIONAMIENTO_IP" SectionOrder="8"></sectionDesc>
				<sectionDesc name="SECCION_MODO_EXPLOTACION" SectionOrder="9"></sectionDesc>
				<sectionDesc name="SECCION_COMUNICACION" SectionOrder="10"></sectionDesc>
				<sectionDesc name="SECCION_MANDOS_VIGILANCIA" SectionOrder="11"></sectionDesc>
				<sectionDesc name="SECCION_NUMEROS_MANDOS_SD" SectionOrder="12"></sectionDesc>
				<sectionDesc name="BANDA_TRATA_EQUIPOS" SectionOrder="13"></sectionDesc>
				<sectionDesc name="LECTURAS_SACIS_MB" SectionOrder="14"></sectionDesc>
				<sectionDesc name="FILTRAR_COM_EQUIPOS" SectionOrder="15"></sectionDesc>
				<sectionDesc name="NUM_LECTURAS_MB" SectionOrder="16"></sectionDesc>
				<sectionDesc name="TRATAMIENTO_MEDIDAS_EQ" SectionOrder="17"></sectionDesc>
				<sectionDesc name="METER_EN_COLA_EQUIPOS" SectionOrder="18"></sectionDesc>
				<sectionDesc name="COMUNIC_EQUIPOS" SectionOrder="19"></sectionDesc>
				<sectionDesc name="SECCION_FIN_PRIMER_CICLO" SectionOrder="20"></sectionDesc>
			</taskDesc>
		</resource>
	</logicConf>
	<program>
		<identProgram name="SECCION_PRIMER_CICLO" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(********************************)
(*******PRIMER CICLO*************)
(********************************)

(*Al pasar de stop a run*)
PRIMER_CICLO:=%S21;

IF PRIMER_CICLO THEN
	AUX_P_C:=0;
	TEMP_P_C:=0;
	PRIMER_CICLO:=1;
	PRIMER_CICLO_DATOS_FISICOS_OK:=0;
	PRIMER_CICLO_COMUNIC_OK:=0;
	AUX_EQUIPOS:=1;
	SEGURIDAD:=1;(*ED PARA EVITAR QUE SE EJECUTE ALGUN MANDO DURANTE EL PRIMER CICLO*)

	(*CONFIGURACION HW*)
	(*Para globalizar los bucles FOR, hay que indicar cuantos grupos de 16 bits hay sumando todas las tarjetas*)
	NUM_TARJETAS16_ED:=6;
	NUM_TARJETAS16_SD:=2;
	(* RESETEAR TODOS LOS MANDOS *)
	(* MANDOS DIRECTOS, HAY 32 *)
	FOR I:=1 TO 16*NUM_TARJETAS16_SD DO
		SALIDA[I]:=FALSE;
	END_FOR;

END_IF;

(* OTRAS INICIALIZACIONES *)
R_TRIG_10MSG (CLK:=%S4, Q=&gt;REG_10_MSG); 
R_TRIG_100MSG (CLK:=%S5, Q=&gt;REG_100_MSG); 
R_TRIG_SEG (CLK:=%S6, Q=&gt;REG_1_SG);

IF GR_CTRL_PLC_1_FS THEN
	SEGURIDAD:=1;
ELSE
	SEGURIDAD:=0;
END_IF;

(* SE ANULA por orden de JAVIER MUNGUIRA EL ENCOLAMIENTO Y EL ENVIO ESPONTANEO DE LAS
   MEDIDAS DE LOS EQUIPOS LEIDOS (en este caso 2 SACIs,
   PARA QUE EL SCADA PUEDA LEER DICHAS MEDIDAS DE QUIPOS CADA INTERVALO QUE QUIERA *)

ANULADO_ENVIO_MEDIDAS_EQ:=1;

(*CARGA BANDA TRATAMIENTO EQUIPOS A MAXIMO SE ANULA TEMPORALMENTE PARA QUE SE ENVIEN TODAS
LAS MEDIDAS SEGUN INSTRUCCIONES DE JAVIER MUNGIRA 28/10/08 HECHO POR DAVID*)

(*IF PRIMER_CICLO AND AUX_BT THEN
	FOR PC:=1 TO 20 DO
	B_TRATA_EQUIPOS_PLC_1[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_2[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_3[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_4[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_5[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_6[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_7[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_8[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_9[PC]:=32767;
	B_TRATA_EQUIPOS_PLC_10[PC]:=32767;
	END_FOR;
	AUX_BT:=0;
END_IF;*)
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_SINCRONIZAR_RELOJ" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*************************************************)
(*  SINCRONIZACION del RELOJ del PLC desde el PC *)
(*************************************************)
(* las palabras internas del reloj del PLC son:
     %SW49: día de la semana
1 = Lunes,2 = Martes,3 = Miércoles,4 = Jueves,5 = Viernes,6 = Sábado,7 = Domingo 
     %SW50: segundos (16#SS00). 
     %SW51: horas y minutos (16#HHMM). 
     %SW52: mes y día (16#MMJJ). 
     %SW53: año (16#AAAA).
   nota:  todo en BCD   
las palabras donde llegan las nuevas consignas desde el PC:
400411 : DIA DE LA SEMANA
400412 : MES
400413 : DIA DEL MES
400414 : AÑO
400415 : HORA
400416 : MIN
400417 : SEG
  y para cargar nuevos valores hay que :
  1º - poner a "1" el bit $S50 "ajustar reloj"
  2º - cargar las palabras de las nuievas consignas
  3º - poner a "0" el bit $S50 "ajustar reloj"
*)
(**************************************************************)
(* CARGA del RELOJ del PLC en el STATUS para uqe lo lea el PC *)
(**************************************************************)


DIA_SEMANA_PLC:=BCD_TO_INT(%SW49);

SEGUNDOS_PLC:=BCD_TO_INT(%SW50/16#100);
(*MSEG_PLC:=HORA_NTP_BCD.Millisecond;*)

MINUTOS_PLC:=BCD_TO_INT(word_to_int((INT_TO_WORD(%SW51)) AND 16#00FF));
HORAS_PLC:=BCD_TO_INT(%SW51/16#100);
HORAS_PLC:=HORAS_PLC-1;
DIA_PLC:=BCD_TO_INT(word_to_int((INT_TO_WORD(%SW52)) AND 16#00FF));
MES_PLC:=BCD_TO_INT(%SW52/16#100);

AÑO_PLC:=BCD_TO_INT(%SW53);
AÑO_PLC:=AÑO_PLC-2000;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_TEST_ENLACE" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(********************************)
 (******   TEST DE ENLACE   ******)
 (********************************)
  
 (* DEL PDC AL SGC *)
  
 (* SI NO COMUNICAMOS EN 2 MINUTOS MANDAMOS UN MENSAJE DE TEST DE ENLACE *)
  
 WTB20 (IN := (INT_TO_WORD(M_R_TEST_ENLACE_PDC_SGC)));
  
 IF WTB20.BIT15 AND WTB20.BIT13 THEN
 TEMP_PDC_SGC:=INT_TO_WORD(M_R_TEST_ENLACE_PDC_SGC);
 TEMP_PDC_SGC:=TEMP_PDC_SGC XOR 16#A000;
 TEMP_PDC_SGC_INT:=WORD_TO_INT(TEMP_PDC_SGC);
 TEMP_TEST_ENLACE:=TEMP_PDC_SGC_INT;
 M_R_TEST_ENLACE_PDC_SGC:=0;
 ALGO_RECIBIDO:=1;
 END_IF;
  
 IF PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1 THEN 
 IF REG_1_SG THEN
 	IF TEMP_TEST_ENLACE&gt;0 THEN
 	TEMP_TEST_ENLACE:=TEMP_TEST_ENLACE-1;
 		IF TEMP_TEST_ENLACE=0 THEN
 			TEST_ENLACE_PDC_SGC:=TEMP_PDC_SGC_INT;
 			TEST_ENLACE_PDC_SGC:=TEST_ENLACE_PDC_SGC+AUX_PDC; (* AUX_PCD = 16#A000 = 1010000000000000 BIN *)
 			ESCRITURA_PDC_SGC_TE:=INT_TO_WORD(TEST_ENLACE_PDC_SGC);
 			ESCRITURAS_ETH_REQ_TE:=1;
 			TEMP_TEST_ENLACE:=TEMP_PDC_SGC_INT;	
     		END_IF;
     	END_IF;
 END_IF;
 	IF ESCRITURAS_ETH_REQ_TE OR ESCRITURAS_ETH_REQ THEN
     	TEMP_TEST_ENLACE:=TEMP_PDC_SGC_INT;
     	END_IF;
 END_IF;
  
 IF ESCRITURAS_ETH_DONE_TE OR ESCRITURAS_ETH_ERROR_TE THEN
 	ESCRITURAS_ETH_REQ_TE:=0;
 END_IF;
  
 IF ESCRITURAS_ETH_REQ_TE THEN
 TIEMPO:=TIEMPO+1;
 END_IF;
  
 IF TIEMPO=20 THEN
 ESCRITURAS_ETH_REQ_TE:=0;
 TIEMPO:=0;
 END_IF;
  
  
 (* DEL SGC AL PCD *)
  
 WTB20 (IN := (INT_TO_WORD(M_R_TEST_ENLACE_SGC_PDC)));
  
 IF WTB20.BIT15=1 AND WTB20.BIT14=1 THEN
 TEMP_SGC_PDC:=INT_TO_WORD(M_R_TEST_ENLACE_SGC_PDC);
 TEMP_SGC_PDC:=TEMP_SGC_PDC XOR 16#C000;
 TEMP_SGC_PDC_INT:=WORD_TO_INT(TEMP_SGC_PDC);
 TEMP_SGC_PDC_INT:=TEMP_SGC_PDC_INT+30;
 TEMP_SGC:=TEMP_SGC_PDC_INT;
 M_R_TEST_ENLACE_SGC_PDC:=0;
 ALGO_RECIBIDO:=1;
 END_IF;
  
 IF ALGO_RECIBIDO THEN
 TEMP_SGC:=TEMP_SGC_PDC_INT;
 ALGO_RECIBIDO:=0;
 END_IF;
  
 IF ALGO_RECIBIDO=0 AND REG_1_SG THEN
 TEMP_SGC:=TEMP_SGC-1;
 	IF TEMP_SGC=0 THEN
 	WTB20 (IN := (INT_TO_WORD(ESTADO_COMUNIC_ACTIVA_LECTURA)));
 	ENLACE_COMUNIC_OK_WORD:=INT_TO_WORD(ENLACE_COMUNIC_OK_LECTURA); 
 		IF WTB20.BIT0 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0001;
 		END_IF;
 		IF WTB20.BIT1 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0002;
 		END_IF;
 		IF WTB20.BIT2 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0004;
 		END_IF;
 		IF WTB20.BIT3 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0008;
 		END_IF;
 		IF WTB20.BIT4 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0010;
 		END_IF;
 		IF WTB20.BIT5 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0020;
 		END_IF;
 		IF WTB20.BIT6 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0040;
 		END_IF;
 		IF WTB20.BIT7 THEN
 		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0080;
 		END_IF;
 	ENLACE_COMUNIC_OK_LECTURA:=WORD_TO_INT(ENLACE_COMUNIC_OK_WORD);	
 	ESTADO_COMUNIC_ACTIVA_LECTURA:=-32768;
 	TEMP_SGC:=TEMP_SGC_PDC_INT;
 	END_IF;
 END_IF;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_COMUNICACION_TEST_ENLACE" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*ETHERNET: 
Se supone que funciona de la siguiente manera :
- cuando se detecta que la ETH no está ocupada ,es decir , está LIBRE,
se puede transmitir el mensaje.
- Parece ser que la cantidad máxima de registros a transmitir es de 100 
registros*)

(*COMUNICACIONES VIA ETHERNET CON EL SGC*)
    
ADDM1 := MUX (K := CONTROL_IP,
                IN0 := IP_NOE_EQUIPO0,
                IN1 := IP_NOE1_EQUIPO1,
		IN2 := IP_NOE2_EQUIPO2,
		IN3 := IP_NOE1_EQUIPO3,
		IN4 := IP_NOE2_EQUIPO4);

IF ESCRITURAS_ETH_REQ_TE THEN
	WRITE_VAR (ADR := ADDM (IN := ADDM1),
	           OBJ := '%MW',
	           NUM := 452,
	           NB := ESCRITURAS_ETH_NO_REG_TE,
	           EMIS := BUF_SAL_TE,
	           GEST := GESTION_COM_TE);
END_IF;

ESCRITURAS_ETH_DONE_TE:=(GESTION_COM_TE[1].0 AND %S5) AND (GESTION_COM_TE[2]=0);
ESCRITURAS_ETH_ERROR_TE:=(GESTION_COM_TE[2]&lt;&gt;0) AND %S6;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_METER_SACAR_DE_COLA" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*Al conectar borramos cola e iniciamos tempo analogicas*)
 IF (PRIMER_CICLO AND PRIMER_CICLO_DATOS_FISICOS_OK=0) OR M_E=1 THEN
(*PV_TEMPO_ANALOGICAS:=TEMP_CONF_CAMBIO_EA;*)
	COLA (comanda :=COLA_BORRAR, 
		buf_entr :=  BUF_ENTR, 
		tipo_ent :=  0,
	    	long_ent :=  0,
	    	long_col := COLA_MAX); 
	COMUNICACIONES_PV:=COMUNICACIONES_SP;
	
	BUF_AUX_ED:=BORRAR_BUF_AUX;
	BUF_AUX_EDC:=BORRAR_BUF_AUX;
	BUF_AUX_SD:=BORRAR_BUF_AUX;
	PERDIDAS_ED:=0;
	PERDIDAS_EDC:=0;
	PERDIDAS_SD:=0;
END_IF; 



(************************************************)
(******   TRATAMIENTO ENTRADAS DIGITALES   ******)
(************************************************)

(* TARJETA 1 *)
DIGITAL_ACTUAL[1]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.3.0, bit1 :=%I0.3.1, bit2 :=%I0.3.2, bit3 :=%I0.3.3, 
                             	       bit4 :=%I0.3.4, bit5 :=%I0.3.5, bit6 :=%I0.3.6, bit7 :=%I0.3.7, 
		                       bit8 :=%I0.3.8, bit9 :=%I0.3.9, bit10:=%I0.3.10, bit11:=%I0.3.11, 
			               bit12:=%I0.3.12, bit13:=%I0.3.13, bit14:=%I0.3.14, bit15:=%I0.3.15));

DIGITAL_ACTUAL[2]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.3.16, bit1 :=%I0.3.17, bit2 :=%I0.3.18, bit3 :=%I0.3.19, 
                       	               bit4 :=%I0.3.20, bit5 :=%I0.3.21, bit6 :=%I0.3.22, bit7 :=%I0.3.23, 
		                       bit8 :=%I0.3.24, bit9 :=%I0.3.25, bit10:=%I0.3.26, bit11:=%I0.3.27, 
			               bit12:=%I0.3.28, bit13:=%I0.3.29, bit14:=%I0.3.30, bit15:=%I0.3.31));

(* TARJETA 2 *)

DIGITAL_ACTUAL[3]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.4.0, bit1 :=%I0.4.1, bit2 :=%I0.4.2, bit3 :=%I0.4.3, 
                             	       bit4 :=%I0.4.4, bit5 :=%I0.4.5, bit6 :=%I0.4.6, bit7 :=%I0.4.7, 
		                       bit8 :=%I0.4.8, bit9 :=%I0.4.9, bit10:=%I0.4.10, bit11:=%I0.4.11, 
			               bit12:=%I0.4.12, bit13:=%I0.4.13, bit14:=%I0.4.14, bit15:=%I0.4.15));

DIGITAL_ACTUAL[4]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.4.16, bit1 :=%I0.4.17, bit2 :=%I0.4.18, bit3 :=%I0.4.19, 
                       	               bit4 :=%I0.4.20, bit5 :=%I0.4.21, bit6 :=%I0.4.22, bit7 :=%I0.4.23, 
		                       bit8 :=%I0.4.24, bit9 :=%I0.4.25, bit10:=%I0.4.26, bit11:=%I0.4.27, 
			               bit12:=%I0.4.28, bit13:=%I0.4.29, bit14:=%I0.4.30, bit15:=%I0.4.31));

(* TARJETA 3 *)

DIGITAL_ACTUAL[5]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.5.0, bit1 :=%I0.5.1, bit2 :=%I0.5.2, bit3 :=%I0.5.3, 
                             	       bit4 :=%I0.5.4, bit5 :=%I0.5.5, bit6 :=%I0.5.6, bit7 :=%I0.5.7, 
		                       bit8 :=%I0.5.8, bit9 :=%I0.5.9, bit10:=%I0.5.10, bit11:=%I0.5.11, 
			               bit12:=%I0.5.12, bit13:=%I0.5.13, bit14:=%I0.5.14, bit15:=%I0.5.15));

DIGITAL_ACTUAL[6]:=WORD_TO_INT(BIT_TO_WORD (bit0 :=%I0.5.16, bit1 :=%I0.5.17, bit2 :=%I0.5.18, bit3 :=%I0.5.19, 
                       	               bit4 :=%I0.5.20, bit5 :=%I0.5.21, bit6 :=%I0.5.22, bit7 :=%I0.5.23, 
		                       bit8 :=%I0.5.24, bit9 :=%I0.5.25, bit10:=%I0.5.26, bit11:=%I0.5.27, 
			               bit12:=%I0.5.28, bit13:=%I0.5.29, bit14:=%I0.5.30, bit15:=%I0.5.31));


(* Ante cambio de entradas digitales anotamos en cola *)
 
IF (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) AND M_E=0 THEN
	FOR I:=1 TO NUM_TARJETAS16_ED DO
		IF DIGITAL_ACTUAL[I]&lt;&gt;DIGITAL_ANTES[I] THEN
			FOR N:=1 TO NUM_TARJETAS16_ED DO
				DIGITAL_ACTUAL_WORD[N]:=INT_TO_WORD (DIGITAL_ACTUAL[N]);
				DIGITAL_ANTES_WORD[N]:=INT_TO_WORD (DIGITAL_ANTES[N]);
				MATRIZ_DIGITAL_WORD[N]:=DIGITAL_ACTUAL_WORD[N] XOR DIGITAL_ANTES_WORD[N];
				MATRIZ_DIGITAL[N]:=WORD_TO_INT (MATRIZ_DIGITAL_WORD[N]);
			END_FOR;
			PALABRA_CAMBIOS:=4;
			BUF_ENTR[1]:=PALABRA_CAMBIOS;
			BUF_ENTR[2]:=DIA_SEMANA_PLC;
			BUF_ENTR[3]:=MES_PLC;
			BUF_ENTR[4]:=DIA_PLC;
			BUF_ENTR[5]:=AÑO_PLC;
			BUF_ENTR[6]:=HORAS_PLC;
			BUF_ENTR[7]:=MINUTOS_PLC;
			BUF_ENTR[8]:=SEGUNDOS_PLC;
			BUF_ENTR[9]:=MSEG_PLC;
			BUF_ENTR[10]:=0;
			FOR J:=1 TO NUM_TARJETAS16_ED DO
				K:=J+10;
				BUF_ENTR[K]:=DIGITAL_ACTUAL[J];
			END_FOR;
			FOR L:=1 TO NUM_TARJETAS16_ED DO
				M:=L+10+NUM_TARJETAS16_ED;
				BUF_ENTR[M]:=-1;   (*MATRIZ_DIGITAL[L];*)(*para envio simultaneo de cambios*)
			END_FOR;
			COLA (comanda :=COLA_INSERTAR,
    				buf_entr :=  BUF_ENTR,    
    				tipo_ent :=  APUNTE_ED,
    				long_ent :=  10+(2*NUM_TARJETAS16_ED),
    				long_col := COLA_MAX);
    			IF COLA.AL_BUF=0 THEN
				DIGITAL_ANTES:=DIGITAL_ACTUAL;
			ELSE
				PERDIDAS_ED:=PERDIDAS_ED+1;
			END_IF;
			EXIT;
		END_IF;
	END_FOR;
END_IF;

(***********************************************************)
(******   TRATAMIENTO ENTRADAS DIGITALES CALCULADAS   ******)
(***********************************************************)
 
(*Digitales calculadas*)
FOR I:=1 TO 20 DO
	J:=16*(I-1);
	DIGITAL_CALCULADAS_ACTUAL[I]:=WORD_TO_INT(BIT_TO_WORD(
					bit0 := ED_CALCULADAS[J+1], bit1 := ED_CALCULADAS[J+2], 
					bit2 := ED_CALCULADAS[J+3], bit3 := ED_CALCULADAS[J+4], 
                       			bit4 := ED_CALCULADAS[J+5], bit5 := ED_CALCULADAS[J+6], 
                       			bit6 := ED_CALCULADAS[J+7], bit7 := ED_CALCULADAS[J+8], 
		                        bit8 := ED_CALCULADAS[J+9], bit9 := ED_CALCULADAS[J+10],  
		                        bit10 := ED_CALCULADAS[J+11], bit11 := ED_CALCULADAS[J+13], 
			                bit12 := ED_CALCULADAS[J+13], bit13 := ED_CALCULADAS[J+14], 
			                bit14 := ED_CALCULADAS[J+15], bit15 := ED_CALCULADAS[J+16]));	
END_FOR;

(* Ante cambio de entradas digitales CALCULADAS anotamos en cola *)
 
IF (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) AND M_E=0 THEN
	FOR I:=1 TO 20 DO
		IF DIGITAL_CALCULADAS_ACTUAL[I]&lt;&gt;DIGITAL_CALCULADAS_ANTES[I] THEN
			FOR N:=1 TO 20 DO
				DIGITAL_CALCULADAS_ACTUAL_WORD[N]:=INT_TO_WORD (DIGITAL_CALCULADAS_ACTUAL[N]);
				DIGITAL_CALCULADAS_ANTES_WORD[N]:=INT_TO_WORD (DIGITAL_CALCULADAS_ANTES[N]);
				MATRIZ_DIGITAL_CALCULADAS_WORD[N]:=  DIGITAL_CALCULADAS_ACTUAL_WORD[N] XOR DIGITAL_CALCULADAS_ANTES_WORD[N];
				MATRIZ_DIGITAL_CALCULADAS[N]:=WORD_TO_INT (MATRIZ_DIGITAL_CALCULADAS_WORD[N]);
			END_FOR;
			PALABRA_CAMBIOS:=8;
			BUF_ENTR[1]:=PALABRA_CAMBIOS;
			BUF_ENTR[2]:=DIA_SEMANA_PLC;
			BUF_ENTR[3]:=MES_PLC;
			BUF_ENTR[4]:=DIA_PLC;
			BUF_ENTR[5]:=AÑO_PLC;
			BUF_ENTR[6]:=HORAS_PLC;
			BUF_ENTR[7]:=MINUTOS_PLC;
			BUF_ENTR[8]:=SEGUNDOS_PLC;
			BUF_ENTR[9]:=MSEG_PLC;
			BUF_ENTR[10]:=0;
			FOR J:=1 TO 20 DO
				K:=J+10;
				BUF_ENTR[K]:=DIGITAL_CALCULADAS_ACTUAL[J];
			END_FOR;
			FOR L:=1 TO 20 DO
				M:=L+30;
				BUF_ENTR[M]:=MATRIZ_DIGITAL_CALCULADAS[L];
			END_FOR;
			COLA (comanda :=COLA_INSERTAR,
    				buf_entr :=  BUF_ENTR,    
    				tipo_ent :=  APUNTE_EDC,
    				long_ent :=  50,
    				long_col := COLA_MAX);
    			IF COLA.AL_BUF=0 THEN
				(*FOR N:=1 TO 20 DO*)
				DIGITAL_CALCULADAS_ANTES:=DIGITAL_CALCULADAS_ACTUAL;
				(*END_FOR;*)
			ELSE
				PERDIDAS_EDC:=PERDIDAS_EDC+1;
			END_IF;
			EXIT;
		END_IF;
	END_FOR;
END_IF;

(**************************************************) 
(******   TRATAMIENTO DE SALIDAS DIGITALES   ******)
(**************************************************)
 
(* TARJETA 1 *)
 
SALIDAS_DIGITALES_ACTUAL[1]:=WORD_TO_INT(BIT_TO_WORD(
					bit0 := %Q0.6.0, bit1 := %Q0.6.1, bit2 := %Q0.6.2, bit3 := %Q0.6.3, 
                       			bit4 := %Q0.6.4, bit5 := %Q0.6.5, bit6 := %Q0.6.6, bit7 := %Q0.6.7, 
		                        bit8 := %Q0.6.8, bit9 := %Q0.6.9, bit10 := %Q0.6.10, bit11 := %Q0.6.11, 
			                bit12 := %Q0.6.12, bit13 := %Q0.6.13, bit14:=%Q0.6.14, bit15 := %Q0.6.15));
			                    
SALIDAS_DIGITALES_ACTUAL[2]:=WORD_TO_INT(BIT_TO_WORD(
					bit0 := %Q0.7.0, bit1 := %Q0.7.1, bit2 := %Q0.7.2, bit3 := %Q0.7.3, 
                       			bit4 := %Q0.7.4, bit5 := %Q0.7.5, bit6 := %Q0.7.6, bit7 := %Q0.7.7, 
		                        bit8 := %Q0.7.8, bit9 := %Q0.7.9, bit10 := %Q0.7.10, bit11 := %Q0.7.11, 
			                bit12 := %Q0.7.12, bit13 := %Q0.7.13, bit14:=%Q0.7.14, bit15 := %Q0.7.15));
			                  			                     
			                  	               
(* Ante cambio de SALIDAS digitales anotamos en cola *)
 
IF (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) AND M_E=0 THEN
	FOR I:=1 TO NUM_TARJETAS16_SD DO
		IF SALIDAS_DIGITALES_ACTUAL[I]&lt;&gt;SALIDAS_DIGITALES_ANTES[I] THEN
			FOR N:=1 TO NUM_TARJETAS16_SD DO
				SALIDAS_DIGITALES_ACTUAL_WORD[N]:=INT_TO_WORD (SALIDAS_DIGITALES_ACTUAL[N]);
				SALIDAS_DIGITALES_ANTES_WORD[N]:=INT_TO_WORD (SALIDAS_DIGITALES_ANTES[N]);
				MATRIZ_SALIDAS_DIGITALES_WORD[N]:=  SALIDAS_DIGITALES_ACTUAL_WORD[N] XOR SALIDAS_DIGITALES_ANTES_WORD[N];
				MATRIZ_SALIDAS_DIGITALES[N]:=WORD_TO_INT (MATRIZ_SALIDAS_DIGITALES_WORD[N]);
			END_FOR;
			PALABRA_CAMBIOS:=16;
			BUF_ENTR[1]:=PALABRA_CAMBIOS;
			BUF_ENTR[2]:=DIA_SEMANA_PLC;
			BUF_ENTR[3]:=MES_PLC;
			BUF_ENTR[4]:=DIA_PLC;
			BUF_ENTR[5]:=AÑO_PLC;
			BUF_ENTR[6]:=HORAS_PLC;
			BUF_ENTR[7]:=MINUTOS_PLC;
			BUF_ENTR[8]:=SEGUNDOS_PLC;
			BUF_ENTR[9]:=MSEG_PLC;
			BUF_ENTR[10]:=0;
			FOR J:=1 TO NUM_TARJETAS16_SD DO
				K:=J+10;
				BUF_ENTR[K]:=SALIDAS_DIGITALES_ACTUAL[J];
			END_FOR;
			FOR L:=1 TO NUM_TARJETAS16_SD DO
				M:=L+10+NUM_TARJETAS16_SD;
				BUF_ENTR[M]:=MATRIZ_SALIDAS_DIGITALES[L];
			END_FOR;
			COLA (comanda :=COLA_INSERTAR,
    			buf_entr :=  BUF_ENTR,    
    			tipo_ent :=  APUNTE_SD,
    			long_ent :=  10+(2*NUM_TARJETAS16_SD),
    			long_col := COLA_MAX);
    			IF COLA.AL_BUF=0 THEN
				SALIDAS_DIGITALES_ANTES:=SALIDAS_DIGITALES_ACTUAL;
			ELSE
				PERDIDAS_SD:=PERDIDAS_SD+1;
			END_IF;
			EXIT;
		END_IF;
	END_FOR;
END_IF;				   
 
(*******************************)
(******   SACAR DE COLA   ******)
(*******************************)
 
IF PRIMER_CICLO THEN
	COMUNICACION:=0;
	COMUNICACION_SCAN:=0;
	ALGO_QUE_ENVIAR:=FALSE;
END_IF;	
 
(*Si podemos enviar, pedimos un apunte de cola*)
IF COLA.puntero&gt;0 AND NOT ALGO_QUE_ENVIAR THEN
	COLA (comanda := COLA_SACAR,
    	buf_entr :=  BUF_ENTR,    
    	tipo_ent :=  0,
    	long_ent :=  0,
    	long_col := COLA_MAX);
	ALGO_QUE_ENVIAR:=TRUE;		
END_IF;
 
PUNTERO:= COLA.puntero;
TIPO_SAL:= COLA.tipo_sal;
LONG_SAL:= COLA.long_sal;
BUF_SAL:= COLA.BUF_SAL;
BORRA:=COLA.BORRA;
 
IF COMUNICACION=0 THEN
	ESCRITURAS_ETH_REQ:=FALSE;
END_IF;
	
IF COMUNICACION=0 AND ALGO_QUE_ENVIAR THEN
	COMUNICACION:=1;
	COMUNICACION_SCAN:=0;
END_IF;	
 
IF COMUNICACION=1 THEN
	COMUNICACION_SCAN:=COMUNICACION_SCAN+1; (* espera un ciclo para enviar el mensaje al FE *)
	IF COMUNICACION_SCAN&gt;=2 THEN
		COMUNICACION:=2;
		COMUNICACION_SCAN:=0;
		
		ESCRITURAS_ETH_REQ:=TRUE;
		ESCRITURAS_ETH_SLAVEREG:= INT_TO_WORD(1800+(1000*(N_PLC)));
		ESCRITURAS_ETH_NO_REG:= INT_TO_WORD (COLA.long_sal);
		(*NOTA: la dirección IP del FE es fija y se pone en la declaracion de var
		        Y n_plc tambien se pone como valor inicial en la declaracion var *)
		BUF_EMISION:=COLA.buf_sal;
		BUF_EMISION[1]:=(COLA.tipo_sal*256)+COLA.long_sal;
 
		ESCRITURAS_ETH_DATABUF:=COLA.buf_sal;		  
		ESCRITURAS_ETH_DATABUF[1]:=(COLA.tipo_sal*256)+COLA.long_sal;
 
		(*
		FOR i:=1 TO j DO
			escrituras_eth_fe_databuf[i]:=COLA.buf_sal[i];
		END_FOR;
		*)
		
		COM_LIBRE:=FALSE;
	END_IF;	
END_IF;
 
IF COMUNICACION=2 THEN
	COMUNICACION_SCAN:=COMUNICACION_SCAN+1;
	IF ESCRITURAS_ETH_DONE THEN
		 COMUNICACION:=3;
		 COMUNICACION_SCAN:=0;
		 ESCRITURAS_ETH_REQ:=FALSE;	
		 ESCRITURAS_ETH_DATABUF[1]:=0;
		 CONT_OK_ETH := CONT_OK_ETH + 1;
		 FE_OK:=1;
	END_IF;
	IF COMUNICACION_SCAN&gt;=10 OR ESCRITURAS_ETH_ERROR THEN
		COMUNICACION:=1;
		COMUNICACION_SCAN:=0;
		COM_LIBRE:=TRUE;
 		CONT_ERROR_ETH := CONT_ERROR_ETH +1;
 		ESCRITURAS_ETH_REQ := FALSE;
 		
	END_IF;
END_IF;
			
IF COMUNICACION=3 THEN
	COMUNICACION_SCAN:=COMUNICACION_SCAN+1;
	IF FE_OK&lt;&gt;0 THEN 
		COMUNICACION:=0;
		COMUNICACION_SCAN:=0;
		ALGO_QUE_ENVIAR:=FALSE;	(* solo se pone FALSE si se ha recibido el OK del FE,
		                           en caso contrario se reintentaría de nuevo envíar *)
		COM_LIBRE:= TRUE;
		CONTESTA_ETH_OK := CONTESTA_ETH_OK +1;
		FE_OK:=0;
	END_IF;
	IF COMUNICACION_SCAN&gt;=20  THEN
		COMUNICACION:=1;
		COMUNICACION_SCAN:=0;
		COM_LIBRE:=TRUE;
		CONTESTA_ETH_NO_OK := CONTESTA_ETH_NO_OK +1;
	END_IF;
END_IF;
 
IF ESCRITURAS_ETH_ERROR OR ESCRITURAS_ETH_DONE THEN
ESCRITURAS_ETH_REQ:=0;
END_IF;

IF ESCRITURAS_ETH_ERROR THEN
	CONT_MSTR_ERROR:=CONT_MSTR_ERROR+1;
END_IF;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_BUF_SAL_COLA_A_LECTURA" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*****************************************************************************************************)
(******   NOVER LOS DATOS DE COMUNES (CAMBIOS) A LA ZONA DE LECTURA DESPUES DE ENVIAR   ******)
(*****************************************************************************************************)
 
IF ESCRITURAS_ETH_DONE THEN
	CAMBIOS_PAQ_LECTURA:=BUF_SAL[1];
END_IF;
 
(**********************************************************************************************)
(******   NOVER LOS DATOS DE ENTRADAS DIGITALES A LA ZONA DE LECTURA DESPUES DE ENVIAR   ******)
(**********************************************************************************************)
 
IF TIPO_SAL=1 AND ESCRITURAS_ETH_DONE AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN
	FOR H:=1 TO NUM_TARJETAS16_ED DO
		H1:=H+10;
		DIGITAL_LECTURA[H]:=BUF_SAL[H1];
	END_FOR; 
END_IF;

(************************************************************************************************)
(******   NOVER LOS DATOS DE DIGITALES CALCULADAS A LA ZONA DE LECTURA DESPUES DE ENVIAR   ******)
(************************************************************************************************)
 
IF TIPO_SAL=2 AND ESCRITURAS_ETH_DONE AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN
	FOR H2:=1 TO 20 DO
		H3:=H2+10;
		DIGITAL_CALCULADAS_LECTURA[H2]:=BUF_SAL[H3];
	END_FOR; 
END_IF;

(*********************************************************************************************)
(******   NOVER LOS DATOS DE SALIDAS DIGITALES A LA ZONA DE LECTURA DESPUES DE ENVIAR   ******)
(*********************************************************************************************)
 
IF TIPO_SAL=3 AND ESCRITURAS_ETH_DONE AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN
	FOR H4:=1 TO NUM_TARJETAS16_SD DO
		H5:=H4+10;
		SALIDAS_DIGITALES_LECTURA[H4]:=BUF_SAL[H5];
	END_FOR; 
END_IF;

(*****************************************************************************************************)
(******   MOVER LOS DATOS DE ESTADOS EQUIPOS  %MW993                                            ******)
(*****************************************************************************************************)
 
IF ESCRITURAS_ETH_DONE_EQ AND BUF_EQUIPOS[1]=0 AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN 
	ANALOGICAS_EQUIPOS_1_16:=INT_TO_WORD(IN:=BUF_EQUIPOS[11]); 
END_IF;


(*********************************************************************************************)
(******   NOVER LOS DATOS DE eq 1,2,3,4 MAR144 A LA ZONA DE LECTURA DESPUES DE ENVIAR   ******)
(*********************************************************************************************)

(* 15-3-2017 SE ANULA por orden de JAVIER MUNGUIRA EL ENCOLAMIENTO Y EL ENVIO ESPONTANEO
   DE LAS MEDIDAS DE EQUIPOS, PARA QUE EL SCADA PUEDA LEER DICHAS MEDIDAS CUANDO QUIERA *) 
(*   INICIO ANULACION *)
(*  EQUIPO1
IF ESCRITURAS_ETH_DONE_EQ AND BUF_EQUIPOS[1]=1 AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN
	FOR H4:=1 TO 40 DO
	H5:=H4+10;
	ANALOGICAS_EQUIPO1[H4]:=BUF_EQUIPOS[H5];
	END_FOR; 
END_IF;
*)
(*  EQUIPO2
IF ESCRITURAS_ETH_DONE_EQ AND BUF_EQUIPOS[1]=2 AND (PRIMER_CICLO=0 OR PRIMER_CICLO_DATOS_FISICOS_OK=1) THEN
	FOR H4:=1 TO 40 DO
	H5:=H4+10;
	ANALOGICAS_EQUIPO2[H4]:=BUF_EQUIPOS[H5];
	END_FOR; 
END_IF; 
*)   (* FIN ANULACION *)
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_CARGAR_DAT_PRIMER_CICLO" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(***********************************************************************************************)
(******   MOVER LOS DATOS DE ENTRADAS DIGITALES A LA ZONA DE LECTURA EN EL PRIMER CICLO   ******)
(***********************************************************************************************)
 
IF PRIMER_CICLO AND PRIMER_CICLO_DATOS_FISICOS_OK=0 THEN
	FOR H:=1 TO NUM_TARJETAS16_ED DO
		DIGITAL_LECTURA[H]:=DIGITAL_ACTUAL[H];
		DIGITAL_ANTES[H]:=DIGITAL_ACTUAL[H];
	END_FOR;
END_IF;
 
(*************************************************************************************************)
(******   MOVER LOS DATOS DE DIGITALES CALCULADAS A LA ZONA DE LECTURA EN EL PRIMER CICLO   ******)
(*************************************************************************************************)
 
IF PRIMER_CICLO AND PRIMER_CICLO_DATOS_FISICOS_OK=0 THEN
	FOR H2:=1 TO 20 DO
		DIGITAL_CALCULADAS_LECTURA[H2]:=DIGITAL_CALCULADAS_ACTUAL[H2];
		DIGITAL_CALCULADAS_ANTES[H2]:=DIGITAL_CALCULADAS_ACTUAL[H2];
	END_FOR; 
END_IF;

(**********************************************************************************************)
(******   MOVER LOS DATOS DE SALIDAS DIGITALES A LA ZONA DE LECTURA EN EL PRIMER CICLO   ******)
(**********************************************************************************************)
 
IF PRIMER_CICLO AND PRIMER_CICLO_DATOS_FISICOS_OK=0 THEN
	FOR H4:=1 TO 13 DO
		SALIDAS_DIGITALES_LECTURA[H4]:=SALIDAS_DIGITALES_ACTUAL[H4];
		SALIDAS_DIGITALES_ANTES[H4]:=SALIDAS_DIGITALES_ACTUAL[H4];
	END_FOR; 
END_IF;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_DIRECCIONAMIENTO_IP" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(* CONDICIONES DE PRIMER CICLO *)
  
IF PRIMER_CICLO=1 THEN
	ESTADO_COMUNIC_ACTIVA:=-32768;
	ENLACE_COMUNIC_OK_LECTURA:=-32513;
END_IF;
(* DIRECCIONAMIENTO PARA LAS COMUNICACIONES*)

WTB5 (IN := (INT_TO_WORD(M_R_ESTADO_COMUNIC_ACTIVA)));
IF WTB5.BIT15 THEN
(* CONMUTAR VIA PARA RESETEO EN CASO DE QUE SE BLOQUEE LA VIA*)
	CONMUTAR_DE_VIA:=1;
	WTB5 (IN := (INT_TO_WORD(ENLACE_COMUNIC_OK_LECTURA)));
	ENLACE_COMUNIC_OK_WORD:=INT_TO_WORD(ENLACE_COMUNIC_OK_LECTURA);
	IF WTB5.BIT15 THEN
		ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#8000;
	END_IF;
	CASE ESTADO_COMUNIC_ACTIVA OF -32768:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
		1:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT0 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0001;
			END_IF;
		2:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT1 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0002;
			END_IF;
		4:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT2 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0004;
			END_IF;
		8:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT3 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0008;
			END_IF;
		16:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT4 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0010;
			END_IF;
		32:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT5 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0020;
			END_IF;
		64:	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT6 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0040;
			END_IF;
		128: 	ESTADO_COMUNIC_ACTIVA_LECTURA:=ESTADO_COMUNIC_ACTIVA;
			IF NOT WTB5.BIT7 THEN
				ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#0080;
			END_IF;
	END_CASE;
	ALGO_RECIBIDO:=1;
	ENLACE_COMUNIC_OK_LECTURA:=WORD_TO_INT(ENLACE_COMUNIC_OK_WORD);
END_IF;

M_R_ESTADO_COMUNIC_ACTIVA:=0;

WTB5 (IN := (INT_TO_WORD(ESTADO_COMUNIC_ACTIVA_LECTURA)));

(* EQUIPO 1 *) 

IF WTB5.BIT0 AND NOT WTB5.BIT15 THEN
	IP_4:=IP_4_1;
	IP_3:=IP_3_1;
	IP_2:=IP_2_1;
	IP_1:=IP_1_1;

	EQUIPO1:=1;
	EQUIPO2:=0;
	EQUIPO3:=0;
	EQUIPO4:=0;
	EQUIPO0:=0;
END_IF;

(* EQUIPO 2 *)

IF WTB5.BIT1 AND NOT WTB5.BIT15 THEN
	IP_4:=IP_4_2;
	IP_3:=IP_3_2;
	IP_2:=IP_2_2;
	IP_1:=IP_1_2;

	EQUIPO1:=0;
	EQUIPO2:=1;
	EQUIPO3:=0;
	EQUIPO4:=0;
	EQUIPO0:=0;
END_IF;

(* EQUIPO 3 *) 

IF WTB5.BIT2 AND NOT WTB5.BIT15 THEN
	IP_4:=IP_4_3;
	IP_3:=IP_3_3;
	IP_2:=IP_2_3;
	IP_1:=IP_1_3;

	EQUIPO1:=0;
	EQUIPO2:=0;
	EQUIPO3:=1;
	EQUIPO4:=0;
	EQUIPO0:=0;
END_IF;

(* EQUIPO 4 *) 

IF WTB5.BIT3 AND NOT WTB5.BIT15 THEN
	IP_4:=IP_4_4;
	IP_3:=IP_3_4;
	IP_2:=IP_2_4;
	IP_1:=IP_1_4;

	EQUIPO1:=0;
	EQUIPO2:=0;
	EQUIPO3:=0;
	EQUIPO4:=1;
	EQUIPO0:=0;
END_IF;



(* COMUNICACION BLOQUEADA *)

IF WTB5.BIT15 THEN
	IP_4:=0;
	IP_3:=0;
	IP_2:=0;
	IP_1:=0;

	EQUIPO1:=0;
	EQUIPO2:=0;
	EQUIPO3:=0;
	EQUIPO4:=0;
	EQUIPO0:=1;

END_IF;

(* SE RESETEA LA ORDEN DE ABORTAR LAS MSTR UN CICLO DESPUES DE ACTIVARLAS *)
(*IF ABORTAR_ETH_REQ OR ABORTAR_ETH_REQ_TE OR ABORTAR_ETH_REG_EQ THEN
ABORTAR_ETH_REQ:=0;
	ABORTAR_ETH_REQ_TE:=0;
	ABORTAR_ETH_REG_EQ:=0;
END_IF;*)

(* ELECCION DE TARJETA NOE DE ETHERNET PARA LA COMUNICACION CON EL SGC *)

IF WTB5.BIT0 OR WTB5.BIT2 THEN

	NOE1:=1;
	NOE2:=0;

	(*CONTROL_ETH_TE[5]:=16#FE00; (* FE= 254 SLOT DE LA NOE CUANDO ESTA INTEGRADO EN LA CPU *)
	(*CONTROL_ETH[5]:=16#FE00; (* FE= 254 SLOT DE LA NOE CUANDO ESTA INTEGRADO EN LA CPU *)
	(*CONTROL_ETH_EQ[5]:=16#FE00; *)(* FE= 254 SLOT DE LA NOE CUANDO ESTA INTEGRADO EN LA CPU *)
END_IF;

IF WTB5.BIT1 OR WTB5.BIT3 THEN

	NOE2:=1;
	NOE1:=0;
	
	(*CONTROL_ETH_TE[5]:=16#0400;
	CONTROL_ETH[5]:=16#0400;
	CONTROL_ETH_EQ[5]:=16#0400;  *)
END_IF;

(* LA VARIABLE CONTROL_IP LA GENERO PARA UTILIZAR EL LAS SEC DE FBD DE COMUNICACIONES*)

IF EQUIPO0=1 AND (NOE1 OR NOE2) THEN
	CONTROL_IP:= 0;
END_IF;

IF EQUIPO1=1 AND NOE1 THEN
	CONTROL_IP:= 1;
END_IF;

IF EQUIPO2=1 AND NOE2 THEN
	CONTROL_IP:= 2;
END_IF;

IF EQUIPO3=1 AND NOE1 THEN
	CONTROL_IP:= 3;
END_IF;

IF EQUIPO4=1 AND NOE2 THEN
	CONTROL_IP:= 4;
END_IF;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_MODO_EXPLOTACION" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>WTB38 (IN := (INT_TO_WORD(M_R_MODO_EXPLOTACION)));
IF WTB38.BIT15 AND ESCRITURAS_ETH_REQ=0 THEN
	M_E:=WTB38.BIT0;
	WTB38 (IN := (INT_TO_WORD(ESTADO_COMUNIC_ACTIVA_LECTURA)));
	IF M_E=1 AND WTB38.BIT14=0 THEN
		ESTADO_COMUNIC_ACTIVA_WORD:=INT_TO_WORD(ESTADO_COMUNIC_ACTIVA_LECTURA);
		ESTADO_COMUNIC_ACTIVA_WORD:=ESTADO_COMUNIC_ACTIVA_WORD XOR 16#4000;
		ESTADO_COMUNIC_ACTIVA_LECTURA:=WORD_TO_INT(ESTADO_COMUNIC_ACTIVA_WORD);
	END_IF;
	IF M_E=0 AND WTB38.BIT14=1 THEN
		ESTADO_COMUNIC_ACTIVA_WORD:=INT_TO_WORD(ESTADO_COMUNIC_ACTIVA_LECTURA);
		ESTADO_COMUNIC_ACTIVA_WORD:=ESTADO_COMUNIC_ACTIVA_WORD XOR 16#4000;
		ESTADO_COMUNIC_ACTIVA_LECTURA:=WORD_TO_INT(ESTADO_COMUNIC_ACTIVA_WORD);
	END_IF;
	M_R_MODO_EXPLOTACION:=0;
END_IF;


(**************************************************************************************)
(******   NOVER LOS DATOS DE ENTRADAS DIGITALES A LA ZONA DE LECTURA CON M_E=1   ******)
(**************************************************************************************)

IF M_E=1 THEN
	FOR H:=1 TO NUM_TARJETAS16_ED DO
		DIGITAL_LECTURA[H]:=DIGITAL_ACTUAL[H];
	END_FOR; 
END_IF;

(****************************************************************************************)
(******   NOVER LOS DATOS DE DIGITALES CALCULADAS A LA ZONA DE LECTURA CON M_E=1   ******)
(****************************************************************************************)

IF M_E=1 THEN
	FOR H:=1 TO 20 DO
		DIGITAL_CALCULADAS_LECTURA[H]:=DIGITAL_CALCULADAS_ACTUAL[H];
	END_FOR; 
END_IF;


(*************************************************************************************)
(******   NOVER LOS DATOS DE SALIDAS DIGITALES A LA ZONA DE LECTURA CON M_E=1   ******)
(*************************************************************************************)

IF M_E=1 THEN
	FOR H:=1 TO NUM_TARJETAS16_SD DO
		SALIDAS_DIGITALES_LECTURA[H]:=SALIDAS_DIGITALES_ACTUAL[H];
	END_FOR; 
END_IF;

(*******************************************************************************)
(******   NOVER LOS DATOS DE LOS EQUIPOS A LA ZONA DE LECTURA CON M_E=1   ******)
(*******************************************************************************)

IF M_E=1 THEN
	FOR H:=1 TO 40 DO
		ANALOGICAS_EQUIPOS_LECTURA[H]:=ANALOGICAS_EQUIPOS_ACTUAL[H];
	END_FOR;
END_IF;


(*******************************************************************************)
(******   NOVER LOS DATOS DE LOS EQUIPOS A LA ZONA DE LECTURA CON M_E=1   ******)
(*******************************************************************************)
(* 15-3-2017 por orden de JAVIER MUNGUIRA SE ANULA EL ENCOLAMIENTO Y EL ENVIO ESPONTANEO DE LAS 
MEDIDAS DE LOS EQUIPOS, PARA QUE EL SCADA LAS PUEDA LEER CUANDO QUIERA,
POR LO TANTO DA IGUAL QUE EL MODO EXPLOTACION POR ENVIO ESPONTANEO ("M_E=0") YA QUE AL ESTAR ANULADO EL 
ENVIO ESPONTANEO PARA LAS MEDIDAS DE EQUIPOS SE DEBEN PONER A SU DISPOSICION EN LA ZONA DE LECTURA *)

IF M_E=1 OR ANULADO_ENVIO_MEDIDAS_EQ THEN
	ANALOGICAS_EQUIPOS_1_16:=ANALOGICAS_CONTROL_EQUIPOS;
	FOR H:=1 TO 40 DO
		ANALOGICAS_EQUIPO1[H]:=ANALOGICAS_EQUIPO1_ACTUAL[H];
	END_FOR;
	FOR H:=1 TO 40 DO
		ANALOGICAS_EQUIPO2[H]:=ANALOGICAS_EQUIPO2_ACTUAL[H];
	END_FOR;
END_IF;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_COMUNICACION" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*ETHERNET: 
Se supone que funciona de la siguiente manera :
- cuando se detecta que la ETH no está ocupada ,es decir , está LIBRE,
se puede transmitir el mensaje.
- Parece ser que la cantidad máxima de registros a transmitir es de 100 
registros*)

(*COMUNICACIONES VIA ETHERNET CON EL SGC*)
    
ADDM1 := MUX (K := CONTROL_IP,
                IN0 := IP_NOE_EQUIPO0,
                IN1 := IP_NOE1_EQUIPO1,
		IN2 := IP_NOE2_EQUIPO2,
		IN3 := IP_NOE1_EQUIPO3,
		IN4 := IP_NOE2_EQUIPO4);

IF ESCRITURAS_ETH_REQ THEN
	WRITE_VAR (ADR := ADDM (IN := ADDM1),
	           OBJ := '%MW',
	           NUM := WORD_TO_DINT(ESCRITURAS_ETH_SLAVEREG),
	           NB := WORD_TO_INT(ESCRITURAS_ETH_NO_REG),
	           EMIS := BUF_SAL,
	           GEST := GESTION_COM);
END_IF;

ESCRITURAS_ETH_DONE:=(GESTION_COM[1].0 AND %S5) AND (GESTION_COM[2]=0);
ESCRITURAS_ETH_ERROR:=(GESTION_COM[2]&lt;&gt;0) AND %S6;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_MANDOS_VIGILANCIA" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(******   MANDO 1   ******)
  
READ4X(IN:= DIR_ESCRITURA_SGC+2);
MANDO_1 := INT_TO_WORD(READ4X.out);

WTB6(IN:=MANDO_1);

IF WTB6.bit15 THEN
	READ4X(IN:= DIR_ESCRITURA_SGC);
	NMANDO_1 :=READ4X.out;
	READ4X(IN:= DIR_ESCRITURA_SGC+1);
	TM1:=READ4X.out;
	mando_temporizado[NMANDO_1]:=wtb6.bit0; (* 1= mando temporizado; 0= mando de estado *)
	mando_sp_temporiz[NMANDO_1]:=TM1;      (* temporización mando si es temporizado *)
	mando_pv_temporiz[NMANDO_1]:=TM1;
	SALIDA[NMANDO_1]:=WTB6.bit1;            (* 1= activar; 0= desactivar *)
	                                       (* Para que funcione con mando temporizado
	                                          debe escribirse como orden 8003H
	                                          bit 0 (mando temporizado)
	                                          bit 1 (estado de la salida a temporizar)
	                                          bit 15(indicación del mensaje nuevo) *)
	mando_ed_pv_temporiz[NMANDO_1]:=mando_ed_sp_temporiz[NMANDO_1];
	ed_vigilancia[NMANDO_1]:=FALSE;
	WRITE4X(stack:=DIR_ESCRITURA_SGC+2,in:= 0);
	ALGO_RECIBIDO:=1;
END_IF;	

(******   MANDO 2   ******)
READ4X(IN:=DIR_ESCRITURA_SGC+5);MANDO_2:=INT_TO_WORD(READ4X.out);

WTB6(IN:=MANDO_2);

IF WTB6.bit15 THEN
	READ4X(IN:= DIR_ESCRITURA_SGC+3);
	NMANDO_2 := READ4X.out;
	READ4X(IN:= DIR_ESCRITURA_SGC+4);
	TM2 :=READ4X.out;
	mando_temporizado[NMANDO_2]:=wtb6.bit0;
	mando_sp_temporiz[NMANDO_2]:=TM2;
	mando_pv_temporiz[NMANDO_2]:=TM2;
	SALIDA[NMANDO_2]:=WTB6.bit1;
	mando_ed_pv_temporiz[NMANDO_2]:=mando_ed_sp_temporiz[NMANDO_2];
	ed_vigilancia[NMANDO_2]:=FALSE;
	WRITE4X(stack:=DIR_ESCRITURA_SGC+5,in:= 0);
	ALGO_RECIBIDO:=1;
END_IF;	

(************************************************************************************)
(******   ASIGNACION DE LOS MANDOS A LAS SALIDAS (VIGILANCIA DE LAS SALIDAS)   ******)
(************************************************************************************)

K:=NUM_TARJETAS16_SD*16;(* "NUM_TARJETAS16_SD: numero de tarjetas de salida como si fueran de 16 bits" *)
FOR I:=1 TO K DO
	IF mando_en_curso[I]=0 AND SALIDA[I]=0 AND mando_temporizado[I]=1 THEN 
		mando_ed_pv_temporiz[I]:=mando_ed_sp_temporiz[I];  (*CARGAMOS LOS VALORES INICIALES PARA CUENDO TENGAMOS UNA SALIDA*)
		mando_pv_temporiz[I]:=mando_sp_temporiz[I];
	END_IF;

	IF SALIDA[I] AND mando_temporizado[I] THEN
		mando_en_curso[I]:=TRUE;
	END_IF;
	(*Mando temporizado*)
	IF mando_en_curso[I] AND mando_temporizado[I] THEN  
		IF REG_100_MSG AND mando_pv_temporiz[I]&gt;0 THEN  (*si el tiempo del impulso no ha terminado*)
			mando_pv_temporiz[I]:=mando_pv_temporiz[I]-1; (*seguimos temporizando el impulso*)
		END_IF;
		IF mando_pv_temporiz[I]=0 AND (mando_sp_temporiz[I]&gt;0)  THEN   (*una vez terminado el tiempo del impulso*)
			SALIDA[I]:=FALSE;             (* quitamos la salida del mando*)
			mando_en_curso[I]:=FALSE;
		END_IF;	
	END_IF;
END_FOR;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_NUMEROS_MANDOS_SD" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>%Q0.6.0:=SALIDA[1] AND NOT SEGURIDAD;
%Q0.6.1:=SALIDA[2] AND NOT SEGURIDAD;
%Q0.6.2:=SALIDA[3] AND NOT SEGURIDAD;
%Q0.6.3:=SALIDA[4] AND NOT SEGURIDAD;
%Q0.6.4:=SALIDA[5] AND NOT SEGURIDAD;
%Q0.6.5:=SALIDA[6] AND NOT SEGURIDAD;
%Q0.6.6:=SALIDA[7] AND NOT SEGURIDAD;
%Q0.6.7:=SALIDA[8] AND NOT SEGURIDAD;
%Q0.6.8:=SALIDA[9] AND NOT SEGURIDAD;
%Q0.6.9:=SALIDA[10] AND NOT SEGURIDAD;
%Q0.6.10:=SALIDA[11] AND NOT SEGURIDAD;
%Q0.6.11:=SALIDA[12] AND NOT SEGURIDAD;
%Q0.6.12:=SALIDA[13] AND NOT SEGURIDAD;
%Q0.6.13:=SALIDA[14] AND NOT SEGURIDAD;
%Q0.6.14:=SALIDA[15] AND NOT SEGURIDAD;
%Q0.6.15:=SALIDA[16] AND NOT SEGURIDAD;
%Q0.7.0:=SALIDA[17] AND NOT SEGURIDAD;
%Q0.7.1:=SALIDA[18] AND NOT SEGURIDAD;
%Q0.7.2:=SALIDA[19] AND NOT SEGURIDAD;
%Q0.7.3:=SALIDA[20] AND NOT SEGURIDAD;
%Q0.7.4:=SALIDA[21] AND NOT SEGURIDAD;
%Q0.7.5:=SALIDA[22] AND NOT SEGURIDAD;
%Q0.7.6:=SALIDA[23] AND NOT SEGURIDAD;
%Q0.7.7:=SALIDA[24] AND NOT SEGURIDAD;
%Q0.7.8:=SALIDA[25] AND NOT SEGURIDAD;
%Q0.7.9:=SALIDA[26] AND NOT SEGURIDAD;
%Q0.7.10:=SALIDA[27] AND NOT SEGURIDAD;
%Q0.7.11:=SALIDA[28] AND NOT SEGURIDAD;
%Q0.7.12:=SALIDA[29] AND NOT SEGURIDAD;
%Q0.7.13:=SALIDA[30] AND NOT SEGURIDAD;
%Q0.7.14:=SALIDA[31] AND NOT SEGURIDAD;
%Q0.7.15:=SALIDA[32] AND NOT SEGURIDAD;
</STSource>
	</program>
	<program>
		<identProgram name="BANDA_TRATA_EQUIPOS" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(* SELECCION DEL NUMERO DE LA BANDA DE TRATAMIENTO A CARGAR *)
  
 WTB10 (IN := (INT_TO_WORD(B_T_EA_1_16_EQ)));
  
 BANDA_TRATAMIENTO_EQ[1]:=WTB10.BIT0;
 BANDA_TRATAMIENTO_EQ[2]:=WTB10.BIT1;
 BANDA_TRATAMIENTO_EQ[3]:=WTB10.BIT2;
 BANDA_TRATAMIENTO_EQ[4]:=WTB10.BIT3;
 BANDA_TRATAMIENTO_EQ[5]:=WTB10.BIT4;
 BANDA_TRATAMIENTO_EQ[6]:=WTB10.BIT5;
 BANDA_TRATAMIENTO_EQ[7]:=WTB10.BIT6;
 BANDA_TRATAMIENTO_EQ[8]:=WTB10.BIT7;
 BANDA_TRATAMIENTO_EQ[9]:=WTB10.BIT8;
 BANDA_TRATAMIENTO_EQ[10]:=WTB10.BIT9;
  
 (* 15-3-2017 Por orden de JAVIER MUNGUIRA SE ANULA EL ENCOLADO Y ENVIO ESPONTANEO DE LAS MEDIDAS DE EQUIPOS
    ,PARA QUE EL SCADA LAS LEA CUANDO QUIERA,
    POR LO QUE TAMBIEN ANULAMOS LAS BANDAS DE TRATAMIENTO *)
IF ANULADO_ENVIO_MEDIDAS_EQ THEN   (* INICIO SECCION ANULADA *)  
 (* CARGA DE BANDA DE TRATAMIENTO VALORES ANALOGICOS DE EQUIPO *)
	WTB10 (IN := (INT_TO_WORD(M_R_BANDA_TRATAMIENTO_EQUIPOS)));
	IF WTB10.BIT15 THEN
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_1 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_1[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_2 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_2[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_3 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_3[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_4 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_4[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_5 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_5[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_6 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_6[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_7 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_7[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_8 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_8[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_9 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_9[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		IF M_R_BANDA_TRATAMIENTO_EQUIPOS=EQUIPO_10 THEN
			FOR I:=1 TO 40 DO
				IF BANDA_TRATAMIENTO_EQ[I] THEN
					B_TRATA_EQUIPOS_PLC_10[I]:=B_TRATA_EQUIPOS[I];
				END_IF;
			END_FOR;
		END_IF;
		ALGO_RECIBIDO:=1;
	END_IF;
 
END_IF;  (* FIN DE SECCION ANULADA *)
  
M_R_BANDA_TRATAMIENTO_EQUIPOS:=0;(*RESET BIT 15 DE BANDA DE TRATAMIENTO EQUIPOS*)
</STSource>
	</program>
	<program>
		<identProgram name="LECTURAS_SACIS_MB" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*LA LECTURA MB DE EQUIPOS SE REALIZA EL LAS SECCIONES DE FB DERIVADOS  "LECTURAS_MB_READ_VAR_M340"*)

LECTURAS_SACIS_FB(NUMERO_LECTURAS:=Numero_lecturas_READ_VAR,
		  NUMERO_REINTENTOS:=Numero_reintentos_READ_VAR,
		  NUEVO_COMIENZO_INDEXADO:=INDEX_READVAR_TRAS_PETICION,
		  HABILITAR:=1,
		  ARRAY_LECTURAS:=Lecturas_SACIS,
		  ARRAY_GEST:=Param_gestion_READ_VAR,
		  MODIFICAR_PETICION:=MODIFICA_ORDEN_PETICION_READVAR,
		  CONTAJE_INDEX_READ_VAR:=Contaje_INDEX_Read_Var,
		  BUSY =&gt; Ocupado_lecturas_READ_VAR,
                  INDEX =&gt; Indice_lectura_READ_VAR);
</STSource>
	</program>
	<program>
		<identProgram name="FILTRAR_COM_EQUIPOS" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*Cada equipo de medida tiene 4 consultas (a 4 zonas de memoria)*)

ESTADO_EQUIPOS[1] := AND (IN1 := Lecturas_SACIS[1].Fallo,
                    	  IN2 := Lecturas_SACIS[2].Fallo,
			  IN3 := Lecturas_SACIS[3].Fallo,
			  IN4 := Lecturas_SACIS[4].Fallo,
			  IN5 := FALLO_PUERTO_SERIE);

ESTADO_EQUIPOS[2] := AND (IN1 := Lecturas_SACIS[5].Fallo,
                    	  IN2 := Lecturas_SACIS[6].Fallo,
			  IN3 := Lecturas_SACIS[7].Fallo,
			  IN4 := Lecturas_SACIS[8].Fallo,
			  IN5 := FALLO_PUERTO_SERIE);

FBI_24_28(IN:=ESTADO_EQUIPOS[1],
	  PT:=t#60s);
FBI_24_22(IN:=ESTADO_EQUIPOS[2],
	  PT:=t#60s);

ANALOGICAS_CONTROL_EQUIPOS := BIT_TO_WORD (BIT0 := FBI_24_28.Q,
		                           BIT1 := FBI_24_22.Q,
		                           BIT2 := FALSE,
		                           BIT3 := FALSE,
		                           BIT4 := FALSE,
		                           BIT5 := FALSE,
		                           BIT6 := FALSE,
		                           BIT7 := FALSE,
		                           BIT8 := FALSE,
		                           BIT9 := FALSE,
		                           BIT10 := FALSE,
		                           BIT11 := FALSE,
		                           BIT12 := FALSE,
		                           BIT13 := FALSE,
		                           BIT14 := FALSE,
		                           BIT15 := FALSE);
</STSource>
	</program>
	<program>
		<identProgram name="NUM_LECTURAS_MB" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>FOR i:=1 TO 100 DO

	IF Lecturas_SACIS[i].Terminal='' THEN
		EXIT;
	ELSE
		Numero_lecturas_READ_VAR:=i;
	END_IF;

END_FOR;

(*FOR j:=1 TO 100 DO

	IF Lecturas_ANALIZADOR[j].Terminal='' THEN
		EXIT;
	ELSE
		Numero_lecturas_READ_VAR_cvm:=j;
	END_IF;
END_FOR;*)
</STSource>
	</program>
	<program>
		<identProgram name="TRATAMIENTO_MEDIDAS_EQ" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*SACI MAR144*)

    (* Para que sea similar a la integracion de SACIS MAR144 de programas Concept de Barajas  *)
    (* Como Lecturas_SACIS es un Array tipo INT y en concept llega tipo Real se utiliza el PUT4X para luego pasarlo a Real *)

(*EQUIPO_1 y EQUIPO_2*)(* anulados 29-11-2017, ya que se cambian los SACI por SOCOMEC *)

(*EQUIPO_1*)(* Se cambia el SACI por un SOCOMEC *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[1]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[2]));
SOCOMEC1_V12:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO1_ACTUAL[1] := REAL_TO_INT (IN := SOCOMEC1_V12);   (*SACI1_V12*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[3]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[4]));
SOCOMEC1_V23:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO1_ACTUAL[2] := REAL_TO_INT (IN := SOCOMEC1_V23);   (*SACI1_V23*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[5]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[6]));
SOCOMEC1_V31:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO1_ACTUAL[3] := REAL_TO_INT (IN := SOCOMEC1_V31);   (*SACI1_V31*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[15]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[16]));
SOCOMEC1_IR:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO1_ACTUAL[4] := REAL_TO_INT (IN := SOCOMEC1_IR);(*SACI1_IR*)(* mA *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[17]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[18]));
SOCOMEC1_IS:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO1_ACTUAL[5] := REAL_TO_INT (IN := SOCOMEC1_IS);(*SACI1_IS*)(* mA *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[19]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[1].Array_destino[20]));
SOCOMEC1_IT:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO1_ACTUAL[6] := REAL_TO_INT (IN := SOCOMEC1_IT);(*SACI1_IT*)(* mA *)

aux_3:= INT_TO_UINT (IN := Lecturas_SACIS[2].Array_destino[1]); 
aux_4:= INT_TO_UINT (IN := Lecturas_SACIS[2].Array_destino[2]); 
aux_1 := UINT_TO_REAL (IN := aux_3);   
aux_2 := UINT_TO_REAL (IN := aux_4);  
SOCOMEC1_P_TOTAL:=(aux_1*65535.0)+aux_2;
ANALOGICAS_EQUIPO1_ACTUAL[7] := REAL_TO_INT (IN := 10.0*SOCOMEC1_P_TOTAL);  (*SUM POTENCIA ACTIVA +/- *)(*KW/100*)

aux_1:=INT_TO_REAL(Lecturas_SACIS[2].Array_destino[8]);
SOCOMEC1_COSENO:=aux_1/1000.0;
ANALOGICAS_EQUIPO1_ACTUAL[8] := REAL_TO_INT (IN := 100.0*SOCOMEC1_COSENO);(*DIR COSENO*)(*0,001*)

ANALOGICAS_EQUIPO1_ACTUAL[9] := Lecturas_SACIS[3].Array_destino[1]; (*DIR E. ACTIVA*)
ANALOGICAS_EQUIPO1_ACTUAL[10] := Lecturas_SACIS[3].Array_destino[2];(*DIR E. ACTIVA*)
ANALOGICAS_EQUIPO1_ACTUAL[11] := Lecturas_SACIS[3].Array_destino[3];(*DIR E. REACTIVA*)
ANALOGICAS_EQUIPO1_ACTUAL[12] := Lecturas_SACIS[3].Array_destino[4];(*DIR E. REACTIVA*)

ANALOGICAS_EQUIPO1_ACTUAL[13] := Lecturas_SACIS[4].Array_destino[1];(*THD IR*)(*%/10*)
ANALOGICAS_EQUIPO1_ACTUAL[14] := Lecturas_SACIS[4].Array_destino[2];(*THD IS*)(*%/10*)
ANALOGICAS_EQUIPO1_ACTUAL[15] := Lecturas_SACIS[4].Array_destino[3];(*THD IT*)(*%/10*)
ANALOGICAS_EQUIPO1_ACTUAL[16] := Lecturas_SACIS[4].Array_destino[4];(*THD IN*)(*%/10*)

(******************************************************************************************************)

(*EQUIPO_2*)(* Se cambia el SACI por un SOCOMEC *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[1]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[2]));
SOCOMEC2_V12:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO2_ACTUAL[1] := REAL_TO_INT (IN := SOCOMEC2_V12);   (*SACI1_V12*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[3]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[4]));
SOCOMEC2_V23:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO2_ACTUAL[2] := REAL_TO_INT (IN := SOCOMEC2_V23);   (*SACI1_V23*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[5]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[6]));
SOCOMEC2_V31:=((aux_1*65535.0)+aux_2)/100.0; 
ANALOGICAS_EQUIPO2_ACTUAL[3] := REAL_TO_INT (IN := SOCOMEC2_V31);   (*SACI1_V31*)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[15]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[16]));
SOCOMEC2_IR:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO2_ACTUAL[4] := REAL_TO_INT (IN := SOCOMEC2_IR);(*SACI1_IR*)(* mA *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[17]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[18]));
SOCOMEC2_IS:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO2_ACTUAL[5] := REAL_TO_INT (IN := SOCOMEC2_IS);(*SACI1_IS*)(* mA *)

aux_1:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[19]));
aux_2:=UINT_TO_REAL(INT_TO_UINT(Lecturas_SACIS[5].Array_destino[20]));
SOCOMEC2_IT:=((aux_1*65535.0)+aux_2)/1000.0; 
ANALOGICAS_EQUIPO2_ACTUAL[6] := REAL_TO_INT (IN := SOCOMEC2_IT);(*SACI1_IT*)(* mA *)

aux_3:= INT_TO_UINT (IN := Lecturas_SACIS[6].Array_destino[1]); 
aux_4:= INT_TO_UINT (IN := Lecturas_SACIS[6].Array_destino[2]); 
aux_1 := UINT_TO_REAL (IN := aux_3);   
aux_2 := UINT_TO_REAL (IN := aux_4);  
SOCOMEC2_P_TOTAL:=(aux_1*65535.0)+aux_2;
ANALOGICAS_EQUIPO2_ACTUAL[7] := REAL_TO_INT (IN := 10.0*SOCOMEC2_P_TOTAL);  (*SUM POTENCIA ACTIVA +/- *)(*KW/100*)

aux_1:=INT_TO_REAL(Lecturas_SACIS[6].Array_destino[8]);
SOCOMEC2_COSENO:=aux_1/1000.0;
ANALOGICAS_EQUIPO2_ACTUAL[8] := REAL_TO_INT (IN := 100.0*SOCOMEC2_COSENO);(*DIR COSENO*)(*0,001*)

ANALOGICAS_EQUIPO2_ACTUAL[9] := Lecturas_SACIS[7].Array_destino[1]; (*DIR E. ACTIVA*)
ANALOGICAS_EQUIPO2_ACTUAL[10] := Lecturas_SACIS[7].Array_destino[2];(*DIR E. ACTIVA*)
ANALOGICAS_EQUIPO2_ACTUAL[11] := Lecturas_SACIS[7].Array_destino[3];(*DIR E. REACTIVA*)
ANALOGICAS_EQUIPO2_ACTUAL[12] := Lecturas_SACIS[7].Array_destino[4];(*DIR E. REACTIVA*)

ANALOGICAS_EQUIPO2_ACTUAL[13] := Lecturas_SACIS[8].Array_destino[1];(*THD IR*)(*%/10*)
ANALOGICAS_EQUIPO2_ACTUAL[14] := Lecturas_SACIS[8].Array_destino[2];(*THD IS*)(*%/10*)
ANALOGICAS_EQUIPO2_ACTUAL[15] := Lecturas_SACIS[8].Array_destino[3];(*THD IT*)(*%/10*)
ANALOGICAS_EQUIPO2_ACTUAL[16] := Lecturas_SACIS[8].Array_destino[4];(*THD IN*)(*%/10*)
</STSource>
	</program>
	<program>
		<identProgram name="METER_EN_COLA_EQUIPOS" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(* 15-3-2017 ANULAMOS ESTA SECCION por orden de JAVIER MUNGUIRA 
   PARA QUE NO HAYA ENVIO ESPONTANEO DE MEDIDAS DE EQUIPOS NI ENCOLAMIENTO DE DICHAS MEDIDAS 
   Y LOS PUEDA LEER DESDE EL SCADA CADA INTERVALO QUE QUIERA *)

IF ANULADO_ENVIO_MEDIDAS_EQ THEN  (* INICIO DE SECCION ANULADA *)

	IF PRIMER_CICLO=0 AND AUX_EQUIPOS=0 AND COMUNIC_EQUIPOS_OK=0 AND M_E=0 THEN	
		IF ANALOGICAS_CONTROL_EQUIPOS&lt;&gt;ANALOGICAS_EQ_ANTERIOR THEN
			MATRIZ_ANALOGICAS_EQ_WORD:=ANALOGICAS_CONTROL_EQUIPOS XOR ANALOGICAS_EQ_ANTERIOR;
			MATRIZ_ANALOGICAS_EQ:=WORD_TO_INT(MATRIZ_ANALOGICAS_EQ_WORD);
			CAMBIOS_EQUIPOS:=0;
			IF CAMBIOS_EQUIPOS=0 THEN
				BUF_EQUIPOS[1]:=CAMBIOS_EQUIPOS;
				BUF_EQUIPOS[2]:=DIA_SEMANA_PLC;
				BUF_EQUIPOS[3]:=MES_PLC;
				BUF_EQUIPOS[4]:=DIA_PLC;
				BUF_EQUIPOS[5]:=AÑO_PLC;
				BUF_EQUIPOS[6]:=HORAS_PLC;
				BUF_EQUIPOS[7]:=MINUTOS_PLC;
				BUF_EQUIPOS[8]:=SEGUNDOS_PLC;
				BUF_EQUIPOS[9]:=MSEG_PLC;
				BUF_EQUIPOS[10]:=0;
				BUF_EQUIPOS[11]:=WORD_TO_INT (IN:=ANALOGICAS_CONTROL_EQUIPOS);
				BUF_EQUIPOS[12]:=MATRIZ_ANALOGICAS_EQ;
				ESCRITURAS_ETH_REQ_EQ:=1;
				ESCRITURAS_ETH_NO_REG_EQ:=12;
				AUX_EQ:=0;
				COMUNIC_EQUIPOS_OK:=1;		
			END_IF;
		END_IF;	
		AUX_EQUIPOS:=AUX_EQUIPOS+1;    
	END_IF;

	IF PRIMER_CICLO=0 AND AUX_EQUIPOS=1 AND COMUNIC_EQUIPOS_OK=0 AND M_E=0 THEN	
		FOR B2:=1 TO 40 DO
			IF ESTADO_EQUIPOS[1] AND ((ABS(ANALOGICAS_EQUIPO1_ACTUAL[B2]-ANALOGICAS_EQUIPO1_ANTERIOR[B2])&gt;B_TRATA_EQUIPOS_PLC_1[B2])) THEN
				CAMBIOS_EQUIPOS:=1;
			END_IF;
		END_FOR;
		IF CAMBIOS_EQUIPOS=1 THEN
			FOR B3:=1 TO 40 DO
				BUF_EQUIPOS[1]:=CAMBIOS_EQUIPOS;
				BUF_EQUIPOS[2]:=DIA_SEMANA_PLC;
				BUF_EQUIPOS[3]:=MES_PLC;
				BUF_EQUIPOS[4]:=DIA_PLC;
				BUF_EQUIPOS[5]:=AÑO_PLC;
				BUF_EQUIPOS[6]:=HORAS_PLC;
				BUF_EQUIPOS[7]:=MINUTOS_PLC;
				BUF_EQUIPOS[8]:=SEGUNDOS_PLC;
				BUF_EQUIPOS[9]:=MSEG_PLC;
				BUF_EQUIPOS[10]:=0;
				B4:=B3+10;
				BUF_EQUIPOS[B4]:=ANALOGICAS_EQUIPO1_ACTUAL[B3];
				COMUNIC_EQUIPOS_OK:=1;
				AUX_EQ:=0;
				ANALOGICAS_EQUIPO1_ANTERIOR[B3]:=ANALOGICAS_EQUIPO1_ACTUAL[B3];
			END_FOR;
			ESCRITURAS_ETH_REQ_EQ:=0;  (* DESABILITADO ESPONTANEAS DE EQUIPOS, SE HACE UNA LECTURA TEMPORAL SCADA *)
			ESCRITURAS_ETH_NO_REG_EQ:=50;
		END_IF;
		AUX_EQUIPOS:=AUX_EQUIPOS+1;
	END_IF;
	CAMBIOS_EQUIPOS:=0;

	IF PRIMER_CICLO=0 AND AUX_EQUIPOS=2 AND COMUNIC_EQUIPOS_OK=0 AND M_E=0 THEN	
		FOR B2:=1 TO 40 DO
			IF  ESTADO_EQUIPOS[2] AND ((ABS(ANALOGICAS_EQUIPO2_ACTUAL[B2]-ANALOGICAS_EQUIPO2_ANTERIOR[B2])&gt;B_TRATA_EQUIPOS_PLC_2[B2])) THEN
				CAMBIOS_EQUIPOS:=2;
			END_IF;
		END_FOR;	
		IF CAMBIOS_EQUIPOS=2 THEN
			FOR B3:=1 TO 40 DO
				BUF_EQUIPOS[1]:=CAMBIOS_EQUIPOS;
				BUF_EQUIPOS[2]:=DIA_SEMANA_PLC;
				BUF_EQUIPOS[3]:=MES_PLC;
				BUF_EQUIPOS[4]:=DIA_PLC;
				BUF_EQUIPOS[5]:=AÑO_PLC;
				BUF_EQUIPOS[6]:=HORAS_PLC;
				BUF_EQUIPOS[7]:=MINUTOS_PLC;
				BUF_EQUIPOS[8]:=SEGUNDOS_PLC;
				BUF_EQUIPOS[9]:=MSEG_PLC;
				BUF_EQUIPOS[10]:=0;
				B4:=B3+10;
				BUF_EQUIPOS[B4]:=ANALOGICAS_EQUIPO2_ACTUAL[B3];
				COMUNIC_EQUIPOS_OK:=1;
				AUX_EQ:=0;
				ANALOGICAS_EQUIPO2_ANTERIOR[B3]:=ANALOGICAS_EQUIPO2_ACTUAL[B3];
			END_FOR;
			ESCRITURAS_ETH_REQ_EQ:=0; (* DESABILITADO ESPONTANEAS DE EQUIPOS, SE HACE UNA LECTURA TEMPORAL SCADA *)
			ESCRITURAS_ETH_NO_REG_EQ:=50;
		END_IF;
		AUX_EQUIPOS:=0;
	END_IF;
	CAMBIOS_EQUIPOS:=0;
	IF COMUNIC_EQUIPOS_OK THEN
		CICLOS_EQ:=CICLOS_EQ+1;
	END_IF;
	IF ESCRITURAS_ETH_DONE_EQ OR ESCRITURAS_ETH_ERROR_EQ OR AUX_EQ THEN
		ESCRITURAS_ETH_REQ_EQ:=0;
		AUX_EQ:=1;
		IF CICLOS_EQ&gt;=50 THEN
			ESCRITURAS_ETH_REQ_EQ:=0;
			COMUNIC_EQUIPOS_OK:=0;
			CICLOS_EQ:=0;
			AUX_EQ:=0;
		END_IF;
	END_IF;
END_IF; (* FIN DE LA SECCION ANULADA *)
</STSource>
	</program>
	<program>
		<identProgram name="COMUNIC_EQUIPOS" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(*ETHERNET: 
Se supone que funciona de la siguiente manera :
- cuando se detecta que la ETH no está ocupada ,es decir , está LIBRE,
se puede transmitir el mensaje.
- Parece ser que la cantidad máxima de registros a transmitir es de 100 
registros*)

(*COMUNICACIONES VIA ETHERNET CON EL SGC*)
    
ADDM1 := MUX (K := CONTROL_IP,
                IN0 := IP_NOE_EQUIPO0,
                IN1 := IP_NOE1_EQUIPO1,
		IN2 := IP_NOE2_EQUIPO2,
		IN3 := IP_NOE1_EQUIPO3,
		IN4 := IP_NOE2_EQUIPO4);

IF ESCRITURAS_ETH_REQ_EQ AND ANULADO_ENVIO_MEDIDAS_EQ THEN
	WRITE_VAR (ADR := ADDM (IN := ADDM1),
	           OBJ := '%MW',
	           NUM := WORD_TO_DINT(ESCRITURAS_ETH_SLAVEREG_EQ),
	           NB := WORD_TO_INT(ESCRITURAS_ETH_NO_REG_EQ),
	           EMIS := BUF_EQUIPOS,
	           GEST := GESTION_COM_EQ);
END_IF;

ESCRITURAS_ETH_DONE_EQ:=(GESTION_COM_EQ[1].0 AND %S5) AND (GESTION_COM_EQ[2]=0);
ESCRITURAS_ETH_ERROR_EQ:=(GESTION_COM_EQ[2]&lt;&gt;0) AND %S6;
</STSource>
	</program>
	<program>
		<identProgram name="SECCION_FIN_PRIMER_CICLO" protectionInfo="notReadable" type="section" task="MAST"></identProgram>
		<STSource>(**********************************)
(******   FIN PRIMER CICLO   ******)
(**********************************)

IF PRIMER_CICLO_DATOS_FISICOS_OK=1 AND PRIMER_CICLO_COMUNIC_OK=1 AND PRIMER_CICLO=0 THEN
	SEGURIDAD:=0;(*ED PARA  QUE SE EJECUTE ALGUN MANDO AL FINALIZAR EL PRIMER CICLO*)
END_IF;

IF PRIMER_CICLO_DATOS_FISICOS_OK=1 AND PRIMER_CICLO_COMUNIC_OK=1 AND PRIMER_CICLO=0 AND (ESTADO_COMUNIC_ACTIVA_LECTURA&lt;&gt;-32768) AND NOT aux THEN
	ENLACE_COMUNIC_OK_WORD:=(INT_TO_WORD(ENLACE_COMUNIC_OK_LECTURA));
	ENLACE_COMUNIC_OK_WORD:=ENLACE_COMUNIC_OK_WORD XOR 16#8000;
	ENLACE_COMUNIC_OK_LECTURA:=(WORD_TO_INT(ENLACE_COMUNIC_OK_WORD));
	aux:=1;
END_IF;

IF PRIMER_CICLO AND PRIMER_CICLO_DATOS_FISICOS_OK=0 THEN
 	FOR I:=1 TO NUM_TARJETAS16_ED DO
	 	IF DIGITAL_LECTURA[I]=DIGITAL_ACTUAL[I] THEN
	 		AUX_ED_PC[I]:=1;
	 	END_IF;
 	END_FOR;
 	FOR I:=1 TO 20 DO
 		IF DIGITAL_CALCULADAS_LECTURA[I]=DIGITAL_CALCULADAS_ACTUAL[I] THEN
 			AUX_EDC_PC[I]:=1;
 		END_IF;
	END_FOR;
	FOR I:=1 TO NUM_TARJETAS16_SD DO
		IF SALIDAS_DIGITALES_LECTURA[I]=SALIDAS_DIGITALES_ACTUAL[I] THEN
			AUX_SD_PC[I]:=1;
		END_IF;	
	END_FOR;
	
 	IF AUX_ED_PC[1] AND AUX_ED_PC[2] AND AUX_ED_PC[3] AND AUX_ED_PC[4] AND
 	AUX_ED_PC[5] AND AUX_ED_PC[6] AND AUX_ED_PC[7] AND AUX_ED_PC[8] AND
 	AUX_ED_PC[9] AND AUX_ED_PC[10] AND AUX_ED_PC[11] AND AUX_ED_PC[12] 
	THEN
 		AUX_ED:=1;
 	END_IF;
 	IF AUX_EDC_PC[1] AND AUX_EDC_PC[2] AND AUX_EDC_PC[3] AND AUX_EDC_PC[4] AND
 	AUX_EDC_PC[5] AND AUX_EDC_PC[6] AND AUX_EDC_PC[7] AND AUX_EDC_PC[8] AND
 	AUX_EDC_PC[9] AND AUX_EDC_PC[10] AND AUX_EDC_PC[11] AND AUX_EDC_PC[12] AND
 	AUX_EDC_PC[13] AND AUX_EDC_PC[14] AND AUX_EDC_PC[15] AND AUX_EDC_PC[16] AND
 	AUX_EDC_PC[17] AND AUX_EDC_PC[18] AND AUX_EDC_PC[19] AND AUX_EDC_PC[20] 
	THEN
 		AUX_EDC:=1;
 	END_IF;
	IF AUX_ED AND AUX_EDC THEN
 		PRIMER_CICLO_DATOS_FISICOS_OK:=1;
 	END_IF;
END_IF;


IF PRIMER_CICLO=1 AND PRIMER_CICLO_DATOS_FISICOS_OK=1 THEN
	IF ESTADO_EQUIPOS[1]=1 THEN
	   AUX_PRIMER_CICLOA[1]:=1;
	   ANALOGICAS_EQUIPO1_ANTERIOR:=ANALOGICAS_EQUIPO1;
	END_IF;
	IF ESTADO_EQUIPOS[2]=1 THEN
	   AUX_PRIMER_CICLOA[2]:=1;
	   ANALOGICAS_EQUIPO2_ANTERIOR:=ANALOGICAS_EQUIPO2;
	END_IF;
END_IF;
 
IF AUX_PRIMER_CICLOA[1]=1 AND AUX_PRIMER_CICLOA[2]=1 THEN
	AUX_PRIMER_CICLOB:=1;
END_IF;

IF PRIMER_CICLO=1 AND PRIMER_CICLO_DATOS_FISICOS_OK=1 THEN
 	PRIMER_CICLO_COMUNIC_OK:=1;
END_IF;

IF REG_100_MSG AND PRIMER_CICLO=1 AND PRIMER_CICLO_DATOS_FISICOS_OK=1 THEN
 	IF NOT AUX_PC THEN
 		TEMP_PRIMER_CICLO_EQUIPOS:=TEMP_PRIMER_CICLO;
 	END_IF;
 	IF AUX_PRIMER_CICLOB=0 AND TEMP_PRIMER_CICLO_EQUIPOS&lt;&gt;0 THEN
 		TEMP_PRIMER_CICLO_EQUIPOS:=TEMP_PRIMER_CICLO_EQUIPOS-1;
 	END_IF;
 	IF TEMP_PRIMER_CICLO_EQUIPOS=0 THEN
 		PRIMER_CICLO_COMUNIC_OK:=1;
 	END_IF;
 	AUX_PC:=1;
END_IF;

IF PRIMER_CICLO=1 AND PRIMER_CICLO_DATOS_FISICOS_OK=1 AND PRIMER_CICLO_COMUNIC_OK=1 THEN
	PRIMER_CICLO:=FALSE;
	AUX_PC:=FALSE;
	AUX_ED_PC[1]:=0; AUX_ED_PC[2]:=0; AUX_ED_PC[3]:=0; AUX_ED_PC[4]:=0;
	AUX_ED_PC[5]:=0; AUX_ED_PC[6]:=0; AUX_ED_PC[7]:=0; AUX_ED_PC[8]:=0;
	AUX_ED_PC[9]:=0; AUX_ED_PC[10]:=0; AUX_ED_PC[11]:=0; AUX_ED_PC[12]:=0;
	AUX_ED_PC[13]:=0; AUX_ED_PC[14]:=0; AUX_ED_PC[15]:=0; AUX_ED_PC[16]:=0;
	AUX_ED_PC[17]:=0; AUX_ED_PC[18]:=0; AUX_ED_PC[19]:=0;
	AUX_EDC_PC[1]:=0; AUX_EDC_PC[2]:=0; AUX_EDC_PC[3]:=0; AUX_EDC_PC[4]:=0;
	AUX_EDC_PC[5]:=0; AUX_EDC_PC[6]:=0; AUX_EDC_PC[7]:=0; AUX_EDC_PC[8]:=0;
	AUX_EDC_PC[9]:=0; AUX_EDC_PC[10]:=0; AUX_EDC_PC[11]:=0; AUX_EDC_PC[12]:=0;
	AUX_EDC_PC[13]:=0; AUX_EDC_PC[14]:=0; AUX_EDC_PC[15]:=0; AUX_EDC_PC[16]:=0;
	AUX_EDC_PC[17]:=0; AUX_EDC_PC[18]:=0; AUX_EDC_PC[19]:=0; AUX_EDC_PC[20]:=0;
	AUX_PRIMER_CICLOA[1]:=0; AUX_PRIMER_CICLOA[2]:=0; 
	AUX_ED:=0;
	AUX_EDC:=0;
	AUX_PRIMER_CICLOB:=0;
END_IF;
</STSource>
	</program>
	<dataBlock>
		<variables name="BUF_EMISION" typeName="intarraycola"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_7" typeName="INTARRAY40" topologicalAddress="%MW7780">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="AUX_PRIMER_CICLOB" typeName="BOOL"></variables>
		<variables name="IP_3_4" typeName="BYTE" topologicalAddress="%MW38">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0001"></variableInit>
		</variables>
		<variables name="EQUIPO_5" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32752"></variableInit>
		</variables>
		<variables name="PRIMER_CICLO_COMUNIC_OK" typeName="BOOL"></variables>
		<variables name="IP_NOE1_EQUIPO3" typeName="string[35]">
			<variableInit value="0.1.0{192.1.4.91}"></variableInit>
		</variables>
		<variables name="WTB10" typeName="WORD_TO_BIT_DFB"></variables>
		<variables name="BUF_SAL" typeName="intarraycola" topologicalAddress="%MW6000">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESCRITURAS_ETH_REQ_EQ" typeName="BOOL"></variables>
		<variables name="SEGUNDOS_PLC" typeName="INT" topologicalAddress="%MW64">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="BUF_AUX_EDC" typeName="intarraycola"></variables>
		<variables name="COM_LIBRE" typeName="BOOL"></variables>
		<variables name="SALIDAS_DIGITALES_ANTES_WORD" typeName="ARRAY[1..128] OF WORD"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_4" typeName="INTARRAY40" topologicalAddress="%MW7660">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="BUF_ENTR" typeName="intarraycola"></variables>
		<variables name="EQUIPO4" typeName="BOOL"></variables>
		<variables name="MES_PLC" typeName="INT" topologicalAddress="%MW59">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="DIGITAL_ANTES_WORD" typeName="WORDARRAY32"></variables>
		<variables name="COMUNICACION_SCAN" typeName="INT"></variables>
		<variables name="MANDO_ED_PV_TEMPORIZ" typeName="INTARRAY400"></variables>
		<variables name="aux_4" typeName="UINT"></variables>
		<variables name="MATRIZ_DIGITAL_CALCULADAS_WORD" typeName="ARRAY[1..40] OF WORD"></variables>
		<variables name="IP_3_3" typeName="BYTE" topologicalAddress="%MW34">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0001"></variableInit>
		</variables>
		<variables name="SEGURIDAD" typeName="BOOL"></variables>
		<variables name="PERDIDAS_SD" typeName="INT"></variables>
		<variables name="CAMBIOS_EQUIPOS" typeName="INT"></variables>
		<variables name="TEMP_SGC_PDC" typeName="WORD"></variables>
		<variables name="ANALOGICAS_EQ_ANTERIOR" typeName="WORD"></variables>
		<variables name="MANDO_EN_CURSO" typeName="BOOLARRAY400"></variables>
		<variables name="COMUNIC_EQUIPOS_OK" typeName="BOOL"></variables>
		<variables name="SOCOMEC1_V31" typeName="REAL" topologicalAddress="%MW3004">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="DIGITAL_CALCULADAS_ANTES" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="ESTADO_COMUNIC_ACTIVA_WORD" typeName="WORD"></variables>
		<variables name="WTB20" typeName="WORD_TO_BIT_DFB"></variables>
		<variables name="SOCOMEC1_P_TOTAL" typeName="REAL" topologicalAddress="%MW3024">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ANALOGICAS_EQUIPO1_ACTUAL" typeName="INTARRAY40" topologicalAddress="%MW6500">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="SALIDAS_DIGITALES_LECTURA" typeName="ARRAY[1..64] OF INT" topologicalAddress="%MW108">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="NMANDO_2" typeName="INT"></variables>
		<variables name="ED_CALCULADAS" typeName="CALCULADAS"></variables>
		<variables name="Ocupado_lecturas_READ_VAR" typeName="BOOL"></variables>
		<variables name="TEMP_SGC" typeName="INT"></variables>
		<variables name="ESCRITURAS_ETH_ERROR" typeName="BOOL"></variables>
		<variables name="INDEX_READVAR_TRAS_PETICION" typeName="INT"></variables>
		<variables name="AUX_ED_PC" typeName="Boolarray32"></variables>
		<variables name="IP_3" typeName="BYTE"></variables>
		<variables name="IP_2_3" typeName="BYTE" topologicalAddress="%MW35">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0100"></variableInit>
		</variables>
		<variables name="FBI_24_28" typeName="TOF"></variables>
		<variables name="WTB6" typeName="WORD_TO_BIT_DFB"></variables>
		<variables name="ESCRITURAS_ETH_NO_REG_EQ" typeName="WORD"></variables>
		<variables name="BORRAR_BUF_AUX" typeName="intarraycola"></variables>
		<variables name="MANDO_SP_TEMPORIZ" typeName="INTARRAY400"></variables>
		<variables name="SOCOMEC2_IS" typeName="REAL" topologicalAddress="%MW3108">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_2" typeName="BYTE"></variables>
		<variables name="B_TRATA_EQUIPOS" typeName="INTARRAY40" topologicalAddress="%MW640">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="H2" typeName="INT"></variables>
		<variables name="CONTESTA_ETH_OK" typeName="INT"></variables>
		<variables name="WRITE4X" typeName="PUT4X"></variables>
		<variables name="H3" typeName="INT"></variables>
		<variables name="MANDO_2" typeName="WORD"></variables>
		<variables name="TEMP_PDC_SGC" typeName="WORD"></variables>
		<variables name="L" typeName="INT"></variables>
		<variables name="EQUIPO_2" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32766"></variableInit>
		</variables>
		<variables name="MATRIZ_DIGITAL_CALCULADAS" typeName="ARRAY[1..40] OF INT"></variables>
		<variables name="IP_1_1" typeName="BYTE" topologicalAddress="%MW28">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0101_0001"></variableInit>
		</variables>
		<variables name="DIGITAL_ACTUAL" typeName="ARRAY[1..32] OF INT"></variables>
		<variables name="ANALOGICAS_EQUIPOS_1_16" typeName="WORD" topologicalAddress="%MW993">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="H5" typeName="INT"></variables>
		<variables name="SOCOMEC1_COSENO" typeName="REAL" topologicalAddress="%MW3030">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESCRITURAS_ETH_DONE" typeName="BOOL"></variables>
		<variables name="GR_CTRL_PLC_1_FS" typeName="BOOL">
			<comment>PLC EN "FUERA DE SERVICIO"</comment>
		</variables>
		<variables name="EQUIPO3" typeName="BOOL"></variables>
		<variables name="ANALOGICAS_EQUIPOS_ACTUAL" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="N" typeName="INT"></variables>
		<variables name="EQUIPO_4" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32760"></variableInit>
		</variables>
		<variables name="ESCRITURAS_ETH_DONE_EQ" typeName="BOOL"></variables>
		<variables name="H4" typeName="INT"></variables>
		<variables name="EQUIPO_10" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32256"></variableInit>
		</variables>
		<variables name="LONG_SAL" typeName="INT"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_5" typeName="INTARRAY40" topologicalAddress="%MW7700">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="EQUIPO_7" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32704"></variableInit>
		</variables>
		<variables name="MSEG_PLC" typeName="INT"></variables>
		<variables name="IP_1_2" typeName="BYTE" topologicalAddress="%MW32">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0101_0001"></variableInit>
		</variables>
		<variables name="SALIDA" typeName="BOOLARRAY400"></variables>
		<variables name="CONTROL_IP" typeName="DINT"></variables>
		<variables name="IP_1_3" typeName="BYTE" topologicalAddress="%MW36">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0101_1011"></variableInit>
		</variables>
		<variables name="COLA_MAX" typeName="INT">
			<variableInit value="4000"></variableInit>
		</variables>
		<variables name="IP_NOE1_EQUIPO1" typeName="string[35]">
			<variableInit value="0.1.0{192.1.4.81}"></variableInit>
		</variables>
		<variables name="DIGITAL_CALCULADAS_ACTUAL_WORD" typeName="ARRAY[1..128] OF WORD"></variables>
		<variables name="ENLACE_COMUNIC_OK_LECTURA" typeName="INT" topologicalAddress="%MW67">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="aux" typeName="BOOL"></variables>
		<variables name="TIPO_SAL" typeName="INT"></variables>
		<variables name="MATRIZ_SALIDAS_DIGITALES" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="MINUTOS_PLC" typeName="INT" topologicalAddress="%MW63">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="MANDO_1" typeName="WORD"></variables>
		<variables name="MANDO_PV_TEMPORIZ" typeName="INTARRAY400"></variables>
		<variables name="CONT_MSTR_ERROR" typeName="INT"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_10" typeName="INTARRAY40" topologicalAddress="%MW7900">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESCRITURAS_ETH_DONE_TE" typeName="BOOL"></variables>
		<variables name="MANDO_TEMPORIZADO" typeName="BOOLARRAY400"></variables>
		<variables name="EQUIPO2" typeName="BOOL"></variables>
		<variables name="MATRIZ_SALIDAS_DIGITALES_WORD" typeName="ARRAY[1..128] OF WORD"></variables>
		<variables name="I" typeName="INT"></variables>
		<variables name="M_R_MODO_EXPLOTACION" typeName="INT" topologicalAddress="%MW717">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_3_2" typeName="BYTE" topologicalAddress="%MW30">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0001"></variableInit>
		</variables>
		<variables name="CONT_OK_ETH" typeName="INT"></variables>
		<variables name="WTB38" typeName="WORD_TO_BIT_DFB"></variables>
		<variables name="CICLOS_EQ" typeName="INT"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_2" typeName="INTARRAY40" topologicalAddress="%MW7540">
			<attribute name="TimeStampSource" value="0"></attribute>
			<instanceElementDesc name="[4]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[5]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[6]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[7]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[8]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[9]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[10]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[11]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[12]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[13]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[14]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[15]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[16]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[17]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[18]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[19]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[20]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[21]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[22]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[23]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[24]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[25]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[26]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[27]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[28]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[29]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[30]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[31]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[32]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[33]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[34]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[35]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[36]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[37]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[38]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[39]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[40]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[1]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[2]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[3]">
				<value>2</value>
			</instanceElementDesc>
		</variables>
		<variables name="DIA_PLC" typeName="INT" topologicalAddress="%MW60">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_3_1" typeName="BYTE" topologicalAddress="%MW26">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0001"></variableInit>
		</variables>
		<variables name="FALLO_PUERTO_SERIE" typeName="BOOL" topologicalAddress="%I0.0.0.ERR">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ENLACE_COMUNIC_OK_WORD" typeName="WORD"></variables>
		<variables name="DIGITAL_ANTES" typeName="ARRAY[1..32] OF INT"></variables>
		<variables name="FBI_24_22" typeName="TOF"></variables>
		<variables name="NOE2" typeName="BOOL"></variables>
		<variables name="Param_gestion_READ_VAR" typeName="ARRAY[1..4] OF INT"></variables>
		<variables name="ALGO_QUE_ENVIAR" typeName="BOOL"></variables>
		<variables name="IP_NOE2_EQUIPO2" typeName="string[35]">
			<variableInit value="0.2.0{192.1.5.81}"></variableInit>
		</variables>
		<variables name="HORAS_PLC" typeName="INT" topologicalAddress="%MW62">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="BANDA_TRATAMIENTO_EQ" typeName="BoolArr32"></variables>
		<variables name="APUNTE_SD" typeName="INT">
			<variableInit value="3"></variableInit>
		</variables>
		<variables name="IP_2_1" typeName="BYTE" topologicalAddress="%MW27">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0100"></variableInit>
		</variables>
		<variables name="aux_2" typeName="REAL"></variables>
		<variables name="Lecturas_SACIS" typeName="ARRAY[1..100] OF Lecturas_Read_Var">
			<comment>lectura de variables del sepam</comment>
			<instanceElementDesc name="[1]">
				<instanceElementDesc name="Terminal">
					<value>0.0.0.1</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50514</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>20</value>
				</instanceElementDesc>
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[2]">
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50536</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>8</value>
				</instanceElementDesc>
				<instanceElementDesc name="Terminal">
					<value>0.0.0.1</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[3]">
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
				<instanceElementDesc name="Terminal">
					<value>0.0.0.1</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50780</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>10</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[5]">
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
				<instanceElementDesc name="Terminal">
					<value>0.0.0.2</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50514</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>20</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[6]">
				<instanceElementDesc name="Terminal">
					<value>0.0.0.2</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50536</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>8</value>
				</instanceElementDesc>
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[4]">
				<instanceElementDesc name="Terminal">
					<value>0.0.0.1</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>51542</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>4</value>
				</instanceElementDesc>
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[7]">
				<instanceElementDesc name="Terminal">
					<value>0.0.0.2</value>
				</instanceElementDesc>
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>50780</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>10</value>
				</instanceElementDesc>
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
			</instanceElementDesc>
			<instanceElementDesc name="[8]">
				<instanceElementDesc name="Dir_inicial_terminal">
					<value>51542</value>
				</instanceElementDesc>
				<instanceElementDesc name="Terminal">
					<value>0.0.0.2</value>
				</instanceElementDesc>
				<instanceElementDesc name="Num_palabras">
					<value>4</value>
				</instanceElementDesc>
				<instanceElementDesc name="Objeto">
					<value>%MW</value>
				</instanceElementDesc>
			</instanceElementDesc>
		</variables>
		<variables name="ANALOGICAS_EQUIPO2_ANTERIOR" typeName="INTARRAY40"></variables>
		<variables name="TEMP_PRIMER_CICLO_EQUIPOS" typeName="INT"></variables>
		<variables name="IP_1" typeName="BYTE"></variables>
		<variables name="REG_100_MSG" typeName="BOOL"></variables>
		<variables name="M_R_ESTADO_COMUNIC_ACTIVA" typeName="INT" topologicalAddress="%MW469">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="DIGITAL_CALCULADAS_LECTURA" typeName="ARRAY[1..64] OF INT" topologicalAddress="%MW88">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="SOCOMEC2_V12" typeName="REAL" topologicalAddress="%MW3100">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="CONMUTAR_DE_VIA" typeName="BOOL"></variables>
		<variables name="N_PLC" typeName="INT">
			<variableInit value="1"></variableInit>
		</variables>
		<variables name="COMUNICACIONES_SP" typeName="ARRAY[0..64] OF INT"></variables>
		<variables name="BUF_AUX_SD" typeName="intarraycola"></variables>
		<variables name="ANALOGICAS_EQUIPO2_ACTUAL" typeName="INTARRAY40" topologicalAddress="%MW6600">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="TM1" typeName="INT"></variables>
		<variables name="MATRIZ_ANALOGICAS_EQ_WORD" typeName="WORD"></variables>
		<variables name="TEMP_TEST_ENLACE" typeName="INT">
			<variableInit value="120"></variableInit>
		</variables>
		<variables name="DIGITAL_ACTUAL_WORD" typeName="WORDARRAY32"></variables>
		<variables name="TIEMPO" typeName="INT"></variables>
		<variables name="SOCOMEC2_V23" typeName="REAL" topologicalAddress="%MW3102">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="M_R_TEST_ENLACE_SGC_PDC" typeName="INT" topologicalAddress="%MW453">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="AUX_EDC_PC" typeName="ARRAY[1..40] OF BOOL"></variables>
		<variables name="CAMBIOS_PAQ_LECTURA" typeName="INT" topologicalAddress="%MW71">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="GESTION_COM" typeName="ARRAY[1..4] OF INT"></variables>
		<variables name="PERDIDAS_EDC" typeName="INT"></variables>
		<variables name="Numero_reintentos_READ_VAR" typeName="INT">
			<variableInit value="3"></variableInit>
		</variables>
		<variables name="DIR_ESCRITURA_SGC" typeName="UINT">
			<variableInit value="462"></variableInit>
		</variables>
		<variables name="SOCOMEC1_IS" typeName="REAL" topologicalAddress="%MW3008">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESTADO_COMUNIC_ACTIVA" typeName="INT" topologicalAddress="%MW468">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_NOE_EQUIPO0" typeName="string[35]">
			<variableInit value="0.0.0{0.0.0.0}"></variableInit>
		</variables>
		<variables name="APUNTE_EDC" typeName="INT">
			<variableInit value="2"></variableInit>
		</variables>
		<variables name="SOCOMEC1_V23" typeName="REAL" topologicalAddress="%MW3002">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="Indice_lectura_READ_VAR" typeName="INT"></variables>
		<variables name="AUX_ED" typeName="BOOL"></variables>
		<variables name="READ4X" typeName="GET4X"></variables>
		<variables name="BUF_AUX_ED" typeName="intarraycola"></variables>
		<variables name="MANDO_ED_SP_TEMPORIZ" typeName="INTARRAY400"></variables>
		<variables name="EQUIPO0" typeName="BOOL"></variables>
		<variables name="AUX_PRIMER_CICLOA" typeName="BoolArr32"></variables>
		<variables name="EQUIPO_6" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32736"></variableInit>
		</variables>
		<variables name="ed_vigilancia" typeName="CALCULADAS"></variables>
		<variables name="IP_2_4" typeName="BYTE" topologicalAddress="%MW39">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0101"></variableInit>
		</variables>
		<variables name="REG_10_MSG" typeName="BOOL"></variables>
		<variables name="PALABRA_CAMBIOS" typeName="INT"></variables>
		<variables name="CONT_ERROR_ETH" typeName="INT"></variables>
		<variables name="SOCOMEC1_IR" typeName="REAL" topologicalAddress="%MW3006">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_1_4" typeName="BYTE" topologicalAddress="%MW40">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0101_1011"></variableInit>
		</variables>
		<variables name="MATRIZ_ANALOGICAS_EQ" typeName="INT"></variables>
		<variables name="NUM_TARJETAS16_ED" typeName="INT"></variables>
		<variables name="SOCOMEC2_IT" typeName="REAL" topologicalAddress="%MW3110">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_4_1" typeName="BYTE" topologicalAddress="%MW25">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#1100_0000"></variableInit>
		</variables>
		<variables name="ESCRITURAS_ETH_ERROR_EQ" typeName="BOOL"></variables>
		<variables name="BORRA" typeName="INT"></variables>
		<variables name="ESCRITURAS_ETH_SLAVEREG_EQ" typeName="WORD">
			<variableInit value="16#0B54"></variableInit>
		</variables>
		<variables name="H" typeName="INT"></variables>
		<variables name="IP_NOE2_EQUIPO4" typeName="string[35]">
			<variableInit value="0.2.0{192.1.5.91}"></variableInit>
		</variables>
		<variables name="B_T_EA_1_16_EQ" typeName="INT" topologicalAddress="%MW680">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ANALOGICAS_EQUIPO2" typeName="INTARRAY40" topologicalAddress="%MW1040">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="AUX_P_C" typeName="BOOL"></variables>
		<variables name="Numero_lecturas_READ_VAR" typeName="INT">
			<variableInit value="1"></variableInit>
		</variables>
		<variables name="SOCOMEC1_V12" typeName="REAL" topologicalAddress="%MW3000">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="M_E" typeName="BOOL"></variables>
		<variables name="MATRIZ_DIGITAL_WORD" typeName="WORDARRAY32"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_3" typeName="INTARRAY40" topologicalAddress="%MW7620">
			<attribute name="TimeStampSource" value="0"></attribute>
			<instanceElementDesc name="[1]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[2]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[3]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[4]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[5]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[6]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[7]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[8]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[9]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[10]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[11]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[12]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[13]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[14]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[15]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[16]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[17]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[18]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[19]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[20]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[21]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[22]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[23]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[24]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[25]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[26]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[27]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[28]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[29]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[30]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[31]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[32]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[33]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[34]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[35]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[36]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[37]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[38]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[39]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[40]">
				<value>1</value>
			</instanceElementDesc>
		</variables>
		<variables name="B4" typeName="INT"></variables>
		<variables name="EQUIPO_1" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32767"></variableInit>
		</variables>
		<variables name="BUF_SAL_TE" typeName="intarraycola" topologicalAddress="%MW6200">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="Contaje_INDEX_Read_Var" typeName="INT"></variables>
		<variables name="MODIFICA_ORDEN_PETICION_READVAR" typeName="BOOL"></variables>
		<variables name="EQUIPO1" typeName="BOOL"></variables>
		<variables name="COMUNICACION" typeName="INT"></variables>
		<variables name="PUNTERO" typeName="INT"></variables>
		<variables name="GESTION_COM_EQ" typeName="ARRAY[1..4] OF INT"></variables>
		<variables name="ESTADO_EQUIPOS" typeName="BoolArr32"></variables>
		<variables name="IP_4_2" typeName="BYTE" topologicalAddress="%MW29">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#1100_0000"></variableInit>
		</variables>
		<variables name="TEMP_P_C" typeName="INT"></variables>
		<variables name="DIGITAL_CALCULADAS_ACTUAL" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="ANALOGICAS_CONTROL_EQUIPOS" typeName="WORD"></variables>
		<variables name="COLA_SACAR" typeName="INT">
			<variableInit value="3"></variableInit>
		</variables>
		<variables name="aux_3" typeName="UINT"></variables>
		<variables name="R_TRIG_10MSG" typeName="R_TRIG"></variables>
		<variables name="K" typeName="INT"></variables>
		<variables name="R_TRIG_100MSG" typeName="R_TRIG"></variables>
		<variables name="FE_OK" typeName="INT"></variables>
		<variables name="ESTADO_COMUNIC_ACTIVA_LECTURA" typeName="INT" topologicalAddress="%MW69">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="M_R_BANDA_TRATAMIENTO_EQUIPOS" typeName="INT" topologicalAddress="%MW681">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="DIGITAL_LECTURA" typeName="ARRAY[1..64] OF INT" topologicalAddress="%MW72">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="EQUIPO_8" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32640"></variableInit>
		</variables>
		<variables name="AUX_EQ" typeName="BOOL"></variables>
		<variables name="ANALOGICAS_EQUIPO1_ANTERIOR" typeName="INTARRAY40"></variables>
		<variables name="IP_4_4" typeName="BYTE" topologicalAddress="%MW37">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#1100_0000"></variableInit>
		</variables>
		<variables name="aux_1" typeName="REAL"></variables>
		<variables name="ANALOGICAS_EQUIPOS_LECTURA" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="NUM_TARJETAS16_SD" typeName="INT"></variables>
		<variables name="SOCOMEC1_IT" typeName="REAL" topologicalAddress="%MW3010">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="PERDIDAS_ED" typeName="INT"></variables>
		<variables name="SOCOMEC2_P_TOTAL" typeName="REAL" topologicalAddress="%MW3124">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESCRITURAS_ETH_NO_REG" typeName="WORD"></variables>
		<variables name="B3" typeName="INT"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_9" typeName="INTARRAY40" topologicalAddress="%MW7860">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="COLA_BORRAR" typeName="INT">
			<variableInit value="1"></variableInit>
		</variables>
		<variables name="IP_4" typeName="BYTE"></variables>
		<variables name="TM2" typeName="INT"></variables>
		<variables name="ESCRITURA_PDC_SGC_TE" typeName="WORD" topologicalAddress="%MW6200">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="ESCRITURAS_ETH_NO_REG_TE" typeName="INT">
			<variableInit value="1"></variableInit>
		</variables>
		<variables name="ALGO_RECIBIDO" typeName="BOOL"></variables>
		<variables name="B2" typeName="INT"></variables>
		<variables name="NMANDO_1" typeName="INT"></variables>
		<variables name="SALIDAS_DIGITALES_ACTUAL_WORD" typeName="ARRAY[1..128] OF WORD"></variables>
		<variables name="SOCOMEC2_COSENO" typeName="REAL" topologicalAddress="%MW3130">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="H1" typeName="INT"></variables>
		<variables name="CONTESTA_ETH_NO_OK" typeName="INT"></variables>
		<variables name="SOCOMEC2_IR" typeName="REAL" topologicalAddress="%MW3106">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="AUX_SD_PC" typeName="ARRAY[1..40] OF BOOL"></variables>
		<variables name="AUX_EQUIPOS" typeName="INT">
			<variableInit value="0"></variableInit>
		</variables>
		<variables name="AÑO_PLC" typeName="INT" topologicalAddress="%MW61">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="AUX_EDC" typeName="BOOL"></variables>
		<variables name="TEMP_SGC_PDC_INT" typeName="INT"></variables>
		<variables name="ESCRITURAS_ETH_REQ_TE" typeName="BOOL"></variables>
		<variables name="AUX_PDC" typeName="INT">
			<variableInit value="-24576"></variableInit>
		</variables>
		<variables name="BUF_EQUIPOS" typeName="intarraycola" topologicalAddress="%MW4900">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="APUNTE_ED" typeName="INT">
			<variableInit value="1"></variableInit>
		</variables>
		<variables name="ESCRITURAS_ETH_REQ" typeName="BOOL"></variables>
		<variables name="COLA" typeName="COLA"></variables>
		<variables name="GESTION_COM_TE" typeName="ARRAY[1..4] OF INT"></variables>
		<variables name="ESCRITURAS_ETH_DATABUF" typeName="intarraycola"></variables>
		<variables name="TEMP_PRIMER_CICLO" typeName="INT">
			<variableInit value="200"></variableInit>
		</variables>
		<variables name="LECTURAS_SACIS_FB" typeName="LECTURAS_MB_READ_VAR_M340"></variables>
		<variables name="IP_2_2" typeName="BYTE" topologicalAddress="%MW31">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#0000_0101"></variableInit>
		</variables>
		<variables name="ESCRITURAS_ETH_ERROR_TE" typeName="BOOL"></variables>
		<variables name="WTB5" typeName="WORD_TO_BIT_DFB"></variables>
		<variables name="SALIDAS_DIGITALES_ANTES" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="DIA_SEMANA_PLC" typeName="INT" topologicalAddress="%MW58">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="TEMP_PDC_SGC_INT" typeName="INT">
			<variableInit value="120"></variableInit>
		</variables>
		<variables name="COLA_INSERTAR" typeName="INT">
			<variableInit value="2"></variableInit>
		</variables>
		<variables name="ANALOGICAS_EQUIPO1" typeName="INTARRAY40" topologicalAddress="%MW1000">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="M_R_TEST_ENLACE_PDC_SGC" typeName="INT" topologicalAddress="%MW452">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="IP_4_3" typeName="BYTE" topologicalAddress="%MW33">
			<attribute name="TimeStampSource" value="0"></attribute>
			<variableInit value="2#1100_0000"></variableInit>
		</variables>
		<variables name="NOE1" typeName="BOOL"></variables>
		<variables name="ADDM1" typeName="string[35]"></variables>
		<variables name="J" typeName="INT"></variables>
		<variables name="COMUNICACIONES_PV" typeName="ARRAY[0..64] OF INT"></variables>
		<variables name="DIGITAL_CALCULADAS_ANTES_WORD" typeName="ARRAY[1..128] OF WORD"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_1" typeName="INTARRAY40" topologicalAddress="%MW7500">
			<attribute name="TimeStampSource" value="0"></attribute>
			<instanceElementDesc name="[1]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[2]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[3]">
				<value>2</value>
			</instanceElementDesc>
			<instanceElementDesc name="[4]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[5]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[6]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[7]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[8]">
				<value>20</value>
			</instanceElementDesc>
			<instanceElementDesc name="[9]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[10]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[11]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[12]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[13]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[14]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[15]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[16]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[17]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[18]">
				<value>100</value>
			</instanceElementDesc>
			<instanceElementDesc name="[19]">
				<value>1</value>
			</instanceElementDesc>
			<instanceElementDesc name="[20]">
				<value>100</value>
			</instanceElementDesc>
			<instanceElementDesc name="[21]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[22]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[23]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[24]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[25]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[26]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[27]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[28]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[29]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[30]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[31]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[32]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[33]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[34]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[35]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[36]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[37]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[38]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[39]">
				<value>10</value>
			</instanceElementDesc>
			<instanceElementDesc name="[40]">
				<value>10</value>
			</instanceElementDesc>
		</variables>
		<variables name="ANULADO_ENVIO_MEDIDAS_EQ" typeName="BOOL">
			<comment>AÑADIDO 15-32017 PARA ANULAR ENCOLADO Y ENVIO ESPONTANEO MEDIDAS EQ</comment>
			<variableInit value="TRUE"></variableInit>
		</variables>
		<variables name="M" typeName="INT"></variables>
		<variables name="EQUIPO_3" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32764"></variableInit>
		</variables>
		<variables name="SOCOMEC2_V31" typeName="REAL" topologicalAddress="%MW3104">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="PRIMER_CICLO_DATOS_FISICOS_OK" typeName="BOOL"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_6" typeName="INTARRAY40" topologicalAddress="%MW7740">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="EQUIPO_9" typeName="INT">
			<attribute name="IsConstant" value="-1"></attribute>
			<variableInit value="-32512"></variableInit>
		</variables>
		<variables name="PRIMER_CICLO" typeName="BOOL"></variables>
		<variables name="ESCRITURAS_ETH_SLAVEREG" typeName="WORD">
			<variableInit value="16#0AF0"></variableInit>
		</variables>
		<variables name="AUX_PC" typeName="BOOL"></variables>
		<variables name="R_TRIG_SEG" typeName="R_TRIG"></variables>
		<variables name="SALIDAS_DIGITALES_ACTUAL" typeName="ARRAY[1..64] OF INT"></variables>
		<variables name="REG_1_SG" typeName="BOOL"></variables>
		<variables name="MATRIZ_DIGITAL" typeName="INTARRAY40"></variables>
		<variables name="B_TRATA_EQUIPOS_PLC_8" typeName="INTARRAY40" topologicalAddress="%MW7820">
			<attribute name="TimeStampSource" value="0"></attribute>
		</variables>
		<variables name="TEST_ENLACE_PDC_SGC" typeName="INT"></variables>
	</dataBlock>
	<DDTSource DDTName="intarraycola" version="2.00" dateTime="dt#2009-02-11-10:02:17">
		<attribute name="TypeSignatureCheckSumString" value="96BA"></attribute>
		<array>ARRAY[1..99] OF INT</array>
	</DDTSource>
	<DDTSource DDTName="INTARRAY40" version="2.00" dateTime="dt#2009-01-27-15:08:55">
		<attribute name="TypeSignatureCheckSumString" value="B469"></attribute>
		<array>ARRAY[1..40] OF INT</array>
	</DDTSource>
	<FBSource nameOfFBType="WORD_TO_BIT_DFB" version="2.00" dateTime="dt#2009-01-26-11:47:37">
		<crypted>8805EC2008B76BC8844267827F2D168FE7D020E3073F1C74DBCBD579F2F69CC196FF58A78789EB3BB05E365857B18B78411ACF63F53431B85F05A11A083CA1A2C86D8D508912CD4A70405F459AA31AAD5F0A7F2813F6195303CDC998B0556A4CE18B3172AFFF07258202C4A1CA1DEEE97AEFECF51BD2305C27D9B38909B28C77C34F4BB907558BF3BD26BEC44969523870D67E9A8A3B4ECED0E10952E65BEAE6E0FA700F30AD9F99EDD1D4A7C90A5DADAB4891AF74D8E8E522B4216CF2DF4DC935002D2F2141796B57315F451D2D9E2F23BBE05384B05DC9FFDBC898AB729193CED34585E830A347F244A6355BA538874813DECAE68840C94820942CBC9CE2307C1C69AFF53803111CF22CAFA0B155D7A65077130542B35E5FDBA7475AEBACEA0781475C21C4C43DB6190A83A6C17B093383B1C699EA5F3ED83146FA3CD88CBC5D01CB602E1100D1286A8489607417F889871F96134353DB270B3782CC636C1A68231AD4BED2E82C8827C9C9C59D709B30C2A9B78F08833A43F94A774D0B3C6CF2EB174B9CB0FF079BF0C13D2FE4CB9F04A34C9E45B3C0709B77CA1A6BA725CE0E87C011C5ADB1B6B4D90D11BCE837590F715112820F03D2211A345C5306F32D61BA57B254E7616E2827636D6C0E911DC873BF5CC3456F83BD0725C2A838211A54F511D25D4E3BFC12C6E05E2CEE9C75389DC98CE81347137A16B587584822508A841CD43F96B62035916408DA833D9A53BE8A384026C9FDA3BA62800E6D970EBE8038DF874DB1048AED0BA136707744BBB74FDB6A2E82C9E5756D0B13A7959E3F9379E35A89455B82283FCB145706833BB2A5C0502BE504EFB605971CA07556F2243DD3DD0A1D2686117C9F59210A801E730AF7084ABF12B51FB2371C349211352935F816E68CE2DD2DFE7859100F86F8BC3A8282B573556DF1F156106FDAB8C5781673B0B1F73B7FAA078A22455597832C6735DA318F2855DE8A6E52AE310DF5203C52C95832204DC03C237F415A570A753D09F1B6091A681F3927A53F57F2D25000B1228D92D4A68EB2D115E33E0B042F8B9812AD97C00B4E5BAD880C67572EA868F90026BC7A314F4932C23F17AF4640A8A3808FAC8BC036E8A6BA5F02FCDFDD9EF292693421A3664F29BBCFB58ABA6CFE259F3C8EB9283B54EDA4A5422025D635B0AC98608EFD913A374A6482E7FFA7404F97717FE9A3DD8EF50C46A78652050DBA9EC11FAB854C3B30EA4177DFAA555F5F645EC8951ECEE3BA6794575812FFC348CFAB8ED51B834F60545B37FE6B6DB22C6CF3D2C8756269D80007A8BAABC63AFEB3DED2E50270D5ABE25902753C1FB99838D4417148629107F36056FF9200328EAB7D98FD63C38520A13FA693DCE4B17817778AA8567BB0431597A1FD41D2418A6E7C3C8402360D598D907E443B089649E307D6C9EC8C7EC3F3B374C8D02903001728C64D74E21B19BE5AFE956BED7A42939310F710734DBE4138A7FD45BE654643D3564C6018ABA2BE476786F475C090BD1D92ADAF1418E0A5856055FD3B2FBCE6F2D7F255B6EE9F8AABFBF77A3DFBDA7687790DD9397CBE7FAAAB3E4B6666BA1D9EA16EE102E08E29C1F0B6E130FA0B722CD32EAB077E545EB9A954E6E1B353E8B08AC07DD0F93113FA1579F1C6A6B11C8F2365F045CE4D96E8C76D5D9E5FD01DEED0DDB20ACF391B0AD456F6BF3A5E168E9422ABBF29C82BA4C4F3F889DC34415368C092AB8596DDF5F50DE4D76549A8C9C5F5469DC7F39F758645054786EA01A77D8B6D2C31B6E71A225E1A9D3DA17496F94C038F4527FEEFB3CECC6F0312F78A6B5F1300FFB60B6936CF6E85F37EE5B166D3F6813C7359AAF8032D43FB0CC5756A7B3D35C71C64F3CD23064236D60F604ED116A053D671E5E612FA821E68B7FC3956B47DD8ABE7F189AAD84C7CA60705C36AFEBED252F0B218C91863F5218085D6AAB4787525514732B54A22F9A22FB68D0D1CE3A0F40E3042A315690B90D2E0AC28FCBDE59AA1246A3577754F8EA36ED523D644DFFD847C4286FDE474DE9C5402A2CE26A0BF59C3932547F96B6EE017D6439BF9CD184638F2058CECF8C5EA85A9F7BFD92290442B1BACBB1425B301C189DB5D2EBBA19A90D33775255FF13FB46D67CCB17CCD9FCA75F08A5075E8CB8D8BC5FE78D9555A578E1CDB9DAD86EEC70E16E3C6B87290800A230882CBE17E96BA5F2A1B57C514122669C26F7730D1A490301935C615BF5F8DEF0A7CF4ECFA71671A06BD6B04C4A2DDC1E719814DC7CBB62CD947A4C864E8DDC7C00FD353317A285979CA8AB51EA652EC4AB0E3A0A5F1B68335291A2DDC6E3FE48357C5B7106A21A0E4B30FEC0398936917639D52D9D4F4120E1A947B9899416C884804B1DEA70CB260743D72FCC2455787540628AE9B3DEB799E6F9B24F00483DBBE3EA607875534D1594322EF2D7F0C9DAFDBDAAFF662E541D88FD3900505E82CE00237E18D4B15CCBEDFFAA126628DBD69D7882667C4147168DF03C204A00F599C9FB9F6AAD5078A6583369E63ED2EACDB43CF60703D4B8285A1643D0A34EF0F09F076DC3B57D55F6DA0D67CAE2F671F9B32CF2B8D99113DA4BF77F8E973415916088D7A76EBA1EEB8881A7668C4E62ECC16C09378C71BBB553C759B2F1FB9F817055D86EEA5FACBB638A4BDF29ADEB10CAFCB7169057BE83EA7BE2C9BF12B694D5F60003640AF1A47A92C20E92EF729BE2FDFF0CAF674ACB626AB560FD404C0C483B2BE518EA5FD5C5244DB7B35AC4CD493A229E54254265A1330215ACDA5A57DA9FAF335377D31B4477FA1D3243DCF14AA2F7F0385FAE8EC3AB0D6D44EDA23F72372DEA99AC92A572209FA6B49AB2F20BD0884B2F442CBE21DB3D0DAE40385FC24171A36824E0571B085E87EEF175F837E8FBDC86847F65E587592D0F8A3E2540DB4EEFA2FB40F24FB498A6D08164CDAEEA5BF75EAD5F00D23E8E2B85EBBCE6CC90DD29E0C8C014693FC16ECBCFF0AED381AFE003AD62368D4DD62CF15D760FC1DFCE7082A74BD3EE4108C0B97E01D1A2630F9D76053B7E610F46D0659B430F96024880637E04A4504997E20A3B532B4E896CE44144F1F3D2CE807AD36045A847F0216CFEF059DFA9BA86883586B70642DFB1718F508D03C7E5A57B1B5C580BE05D0BB0DADA4B31CFF21B1868591A91D61F2BFADDE4C4E29D56738CC2D3DD7B58DE41247AD0B89EE746DB22A4F5FB6F6A5FE15882693CB6FCABE2045815AABFA1BE750A925DB1184C172771F2C0E27356CCD8371BEA8149C1DCFE23D2AF5BA1FCFF6F8B2F596DEDDB25CDBBB0A</crypted>
		<attribute name="TypeCodeCheckSumString" value="F944"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="9603"></attribute>
		<ExternalToolsOnly>
			<inputParameters>
				<variables name="IN" typeName="WORD">
					<attribute name="PositionPin" value="1"></attribute>
				</variables>
			</inputParameters>
			<outputParameters>
				<variables name="BIT0" typeName="BOOL">
					<attribute name="PositionPin" value="1"></attribute>
				</variables>
				<variables name="BIT1" typeName="BOOL">
					<attribute name="PositionPin" value="2"></attribute>
				</variables>
				<variables name="BIT2" typeName="BOOL">
					<attribute name="PositionPin" value="3"></attribute>
				</variables>
				<variables name="BIT3" typeName="BOOL">
					<attribute name="PositionPin" value="4"></attribute>
				</variables>
				<variables name="BIT4" typeName="BOOL">
					<attribute name="PositionPin" value="5"></attribute>
				</variables>
				<variables name="BIT5" typeName="BOOL">
					<attribute name="PositionPin" value="6"></attribute>
				</variables>
				<variables name="BIT6" typeName="BOOL">
					<attribute name="PositionPin" value="7"></attribute>
				</variables>
				<variables name="BIT7" typeName="BOOL">
					<attribute name="PositionPin" value="8"></attribute>
				</variables>
				<variables name="BIT8" typeName="BOOL">
					<attribute name="PositionPin" value="9"></attribute>
				</variables>
				<variables name="BIT9" typeName="BOOL">
					<attribute name="PositionPin" value="10"></attribute>
				</variables>
				<variables name="BIT10" typeName="BOOL">
					<attribute name="PositionPin" value="11"></attribute>
				</variables>
				<variables name="BIT11" typeName="BOOL">
					<attribute name="PositionPin" value="12"></attribute>
				</variables>
				<variables name="BIT12" typeName="BOOL">
					<attribute name="PositionPin" value="13"></attribute>
				</variables>
				<variables name="BIT13" typeName="BOOL">
					<attribute name="PositionPin" value="14"></attribute>
				</variables>
				<variables name="BIT14" typeName="BOOL">
					<attribute name="PositionPin" value="15"></attribute>
				</variables>
				<variables name="BIT15" typeName="BOOL">
					<attribute name="PositionPin" value="16"></attribute>
				</variables>
			</outputParameters>
		</ExternalToolsOnly>
	</FBSource>
	<DDTSource DDTName="WORDARRAY32" version="0.00" dateTime="dt#2009-01-28-12:49:08">
		<attribute name="TypeSignatureCheckSumString" value="1A0A"></attribute>
		<array>ARRAY[1..32] OF WORD</array>
	</DDTSource>
	<DDTSource DDTName="INTARRAY400" version="2.00" dateTime="dt#2002-11-30-12:00:00">
		<attribute name="TypeSignatureCheckSumString" value="FE2B"></attribute>
		<array>ARRAY[0..400] OF INT</array>
	</DDTSource>
	<DDTSource DDTName="BOOLARRAY400" version="2.00" dateTime="dt#2002-11-30-12:00:00">
		<attribute name="TypeSignatureCheckSumString" value="659D"></attribute>
		<array>ARRAY[1..400] OF BOOL</array>
	</DDTSource>
	<DDTSource DDTName="CALCULADAS" version="2.00" dateTime="dt#2002-11-30-12:00:00">
		<attribute name="TypeSignatureCheckSumString" value="9580"></attribute>
		<array>ARRAY[1..320] OF BOOL</array>
	</DDTSource>
	<DDTSource DDTName="Boolarray32" version="0.00" dateTime="dt#2009-01-28-09:36:19">
		<attribute name="TypeSignatureCheckSumString" value="C654"></attribute>
		<array>ARRAY[1..32] OF BOOL</array>
	</DDTSource>
	<FBSource nameOfFBType="PUT4X" version="2.00" dateTime="dt#2009-01-26-11:47:39">
		<crypted>8805EC2008B76BC8844267827F2D168FE7D020E3073F1C74DBCBD579F2F69CC196FF58A78789EB3BB05E365857B18B78411ACF63F53431B85F05A11A083CA1A2C86D8D508912CD4A70405F459AA31AAD5F0A7F2813F6195303CDC998B0556A4CE18B3172AFFF07258202C4A1CA1DEEE97AEFECF51BD2305C27D9B38909B28C77C34F4BB907558BF3BD26BEC44969523870D67E9A8A3B4ECED0E10952E65BEAE6E0FA700F30AD9F99EDD1D4A7C90A5DADAB4891AF74D8E8E522B4216CF2DF4DC935002D2F2141796B57315F451D2D9E2F23BBE05384B05DC9FFDBC898AB729193CED34585E830A347F244A6355BA538874813DECAE68640C94820942CBC9CE2307C1C69AFF53803111CF22CAFA0B155D7A65077130542B35E5FDBA7475AEBACEA0781475C21C4C43DB61D7281A3C17B093383B1C699EA5F3ED83146FA3CD88CBC5D01CB602E1100D1286A8489607417F889871F96134353DB270B3782CC636C1A68231AD4BED3EC5AF927C9C9C59D709B30C2A9B78F08833A43F94A774D0B3C6CF2EB174B9CB0FF079BF0C13D2FE4D18567C073C515A2F761935C965559D555DF65F7A8528FE5A2ABA2DE1016E9F23314042D1E27D05E3AC93B1C2E655506816479F91BB150B6363A372A6E736C46CC40D773AF59C7543DDAE15077C4BC3E181A44F819C4094528E249C7AD6216BCC975118CDEA3E41B564B2A2CC5EF0C176C589F9202D82EC3AC24789A3847FDF74BFA1EED9735592CE9CCA7B17D823A43B437F983268AD116FD51C7EE1EB67F7F7445BBF953B72A3485CDF96E533A08A8DADB3D9767E501881718C97160835E6D089233BF91CD4731BA5AF5B204D143FE5F71D1763CD5C20E4D24AA3945CB46230E8B077827FF154EEE12C96CBB397A59C105333E22B11AF1AAE88A30A2370E190FF6F9AD109987AF706B77A2F145502C88F1CE204036FDECA241129858C40D6275B98A303A628C39933240DD886844C03E01FD782315F872147B0D85173F617B204E45307452C39C083727443864811E71C4847D56F4638797D0B7DAFFEF14F13B2F042EABBD16A1D092400D07FACD542B2162C86BE74931B17B3D0C0B29CE285DFB0D03E2E8C185A587D47EF2FAF50C1DE0A1FBA8ABE0263331A76A6E26F6DAE7DBA01E9358892092A8333C7FB9E4E104672A8668B9ACD621ACFB92272A4C65AAF1D4E90717847352FAB285DEFC0C4BA786141D1CBD83F61CB5895E6760F9006CD8BD52414E721AF69D1D96FCFE44B1700912FFD15ECDA3A1D8268700237B710CD73B6EAC0856A58F9F2B7E73CD551D9FB6BC9279CCB0C89BF80569DE89FF5244052310E8CF3B880F370F6F8F5DB3645AEC97313190AF63C3B570D0CA6B8F1B8CD48FA1B97F1F71C3E36257B41745D6B8E145D27DD6216A75C72312603A91922B4B3F099076E000CBCDAE8E7A8EFFE020FDCD2E0F102E2EC6203FEA5855BB5EB0C068BF2A19D0D07EAA4D6441A95C3CB7AC0284155815D742436419B3AEBB025986EB7190D78B31B4A6AF5D02BBFADE125BE52A62EBD0EBF9CC1EE9B0929BFFE0F06E2DFDCB338D4809D2397C8871B5B12F00296E85069DE222C702FE9A2199A6E4B122E67213159073FC5A335C5EB9F41AF9F0B553E6BCA0E34CCEAB7F38D96A19DFE091ED00937872E554F74389E6BC0D5BEF2CB37992A8EFA90BCF331C419C1C90930B411CD4C413A9F27C9321B9D3D3E5829A2A3A38</crypted>
		<attribute name="TypeCodeCheckSumString" value="BA61"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="82FB"></attribute>
		<ExternalToolsOnly>
			<inputParameters>
				<variables name="STACK" typeName="UINT">
					<attribute name="PositionPin" value="3"></attribute>
				</variables>
				<variables name="IN" typeName="INT">
					<attribute name="PositionPin" value="4"></attribute>
				</variables>
			</inputParameters>
		</ExternalToolsOnly>
	</FBSource>
	<DDTSource DDTName="Lecturas_Read_Var" version="0.01" dateTime="dt#2009-05-27-11:48:18">
		<attribute name="TypeSignatureCheckSumString" value="01B8"></attribute>
		<structure>
			<variables name="Terminal" typeName="STRING">
				<comment>Terminal al que se va acceder (formato: 0.0.0.1-&gt;Bastidor.Slot.Canal.Direccion terminal)</comment>
			</variables>
			<variables name="Dir_inicial_terminal" typeName="DINT">
				<comment>Direccion en la que se va a iniciar la lectura/escritura del terminal</comment>
			</variables>
			<variables name="Num_palabras" typeName="INT">
				<comment>Numero de palabras que se van a leer/escribir (max:20)</comment>
			</variables>
			<variables name="Reintentos" typeName="INT">
				<comment>Numero de reintentos que se van a realizar en la comunicación</comment>
			</variables>
			<variables name="Array_destino" typeName="ARRAY[1..50] OF INT">
				<comment>Posicion inicial dentro del buzón de destino</comment>
			</variables>
			<variables name="Fallo" typeName="BOOL"></variables>
			<variables name="Codigo_fallo" typeName="BYTE"></variables>
			<variables name="Objeto" typeName="STRING">
				<comment>Objeto que vamos a pedir, bien '%MW' o bien '%M'</comment>
			</variables>
		</structure>
	</DDTSource>
	<FBSource nameOfFBType="GET4X" version="2.00" dateTime="dt#2009-01-26-11:47:39">
		<crypted>8805EC2008B76BC8844267827F2D168CE7D020EC3D5A5AE5AF9446E30539B04187A2FD46F7A9DD3E838CAB02DC11996175BDDA26DF619A2C5A410974C1A0BACF7CBC6C488822813E8BB7234056E667631EC3C42F353B5BA107E8657D36685D25AF4F57D8A67B15F8861EB581980155B3D2ACECE3E959B2DBCFC8D6988E0ADF3DCC9F600CA8C8539905D8CD58E0706B753E2EF6B3E1053395F89A64B77743F308931DE76801B5442F43BD02B67F8DDB8BA83D06E79D201EDB53905E315967C5EFF41689F290B34A63C240D44982A8042BCAD98A9312B85509A6C4EF13F9A7E65E211464225156273B37345697248D84B20207708E1B825EB1DD69A9CBE162E943AD61B33A20830AB4B5768C4205B4B6F00E516BED6707AC6A4FA6BCE1EFEC00BA64C5E0DAEF40B1E8DE13840C191D53FF7DAB24A7DE9F38566E7D63FD369A528D24942F8EBE2D577B913E3AA5E5B6A859C06CC4851A9BF28A1AB0216D50D1752945EC1DF8D3CE42615A8188FB9F0F82690645FF9347C6F13C8AE6FE6126C529308F14B5E575A33F9BFC3085ED19ED0AFA40989223FD0231DDB3CBABF090AC841A3FF053447337CECEF882519A7DAC231F5BD7DAFECD869B959024D5248044A10D20987E9010B9CB896121BFC2A664CB93A4C95D8AFDA1731719F51134D36B5B90644D7A163067089BD4BBDDBB4918787CD46A1EBD222173185ED71E81DF9B6EB444752034C6A2D50E20624999DE0585FBD189625A0A4E65C9C46D5B99C64F663B9FBF94662048ECFD0AD85E87A356DC0980513248934D80363661FC02DA29AE79F596D4D084DAE97C40BF97A1EF111C437CA69F2643CEB54A71C291345DDA3914132F9F054DECD1BFB805022354C93BAE10345370473FFA7CC3FF1182A02EA61E6E3BE85DDABE042B38D48B8C6FB9DB4EAA5298B2B6DAFDB4FAFDF2DEB8CCB02CB12323BC8BE4253155833959B1576AD11D9F7C57CBB77F3A0E516234A1E1BA02B75E66E3786D27F8F43884996AF6953AF4B78FBE57094B8EAB789CF0591AD610BE026A0F8CEC82509F5DB940078006B279863E4F66ACCF79C0F253907F22C7962636098A3E75DC8C126D00B4FCC96C2616504E1564A361CC245004BA62BC98ECAF0C70C7B91866009A7D94D94E33F6EDE7413FF0637B6B47DA916DE9B3DF68C458E1F02C90E884FAA347C8714EE37484973BCE863266B68E18B260C995AB9E9BECF5D00131044F5A0642E63E202A82D2672E64FBA386050373A8C6204051BF03C7AC56275D46DF74B54E71BBF9BD1FFDDFB3BECAEAB4AF6C95DF429BCACA081BDF516401326DCAFE6E6C9E6DDDA0B5AD510163095E8C1C8CAD573B7E9B5DD7D3829CFE201DC634500881A7BD1BB09A72957A7FE97A2893D27B68C14CA1E0DDB846EF5C4D127ADD08422645688C9D9CAEE9721DE31631E11E08C3819597B8D39940D70DD502988FD4E47147933F0AEF0BFB3F3EA6AAC7D47C3A87815D8075537F3BA489985E4E1168C463B34A83E8D5D1613648DD1AA6AD35CE00E2C08FBF0118CFCD69F56E323120FAAB908296CBE033F84D466E43403F3874EBB834EB4463D6B006FA533C5050CEC43E29688593F0B06807689F03738FFF3F0CB7980EC8740F1DEEB0169141C76FE07A07D9DFF08F1AE330C566B243E89E1DBA7C4FAFE449ADF96177315118667A9D0BDC365F03E1956DB1F467CE35775D35865ADB2880082296C3759CA992D9D0B9CBB0C028F0237020674A472C698C4EE7E76282F3942818A7F9B2EC</crypted>
		<attribute name="TypeCodeCheckSumString" value="A6E1"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="50DB"></attribute>
		<ExternalToolsOnly>
			<inputParameters>
				<variables name="IN" typeName="UINT">
					<attribute name="PositionPin" value="2"></attribute>
				</variables>
			</inputParameters>
			<outputParameters>
				<variables name="OUT" typeName="INT">
					<attribute name="PositionPin" value="2"></attribute>
				</variables>
			</outputParameters>
		</ExternalToolsOnly>
	</FBSource>
	<FBSource nameOfFBType="COLA" version="2.05" dateTime="dt#2009-04-07-13:00:51">
		<crypted>8805EC2008B76BC8844267827F2D168DE7D020ED9ED85411CDB397A7E96B895534D6EF19285C564199894970434D49541AE121FBAE3D682E7B44DF5D010797D66F2853184C72FC7BE49A830544C60598E358883B8E4F1F61A4037B1645A2288049B0A7ADA31373DD7DB0C4B24917FED36A65672AECAF06802F64473B95EA267E5C833E40C53CCB007B4B707C487937E2520D5DF6626DF3A6532FA3C5ED001A6F6CDFE883E831E388B903534CAFE8C5A4128F15E1073EAD3180F26A1C213521F23502FC8C7BBDB4499D866BC73FC94768D542CB6539DEC338C9AFEA0FEB72FE9F4BEB2798CC42BB5814726F008C8DEBB4D68275F3FF93FA8A817CC5A020CC4EEA0D27E2D7A4C360E473E2737552535CC86502AEA0F4415EC8EEF085ABB987E94D343FB705F68D12D4098EC3CFBC69B0F2998CFE1526D2A8192A2C7004AC81974B5053C723FE8388785F9EDD70EA4EA25630F0FC09BF0040624773667C2F6E426E143CFE7D1C2B2046207DED2C093AA722D12643505C6B8934050245CC5823204A49BF116EE1FD5DBCEE000831C63A936DA1DF9AF12E2D795C47F7AF125F7EABEA0ED828A44370A29E98FA31AA405EF1A7D22527EA1508066657132504A5EB79164B796330939FC5330FCA9071CD5A1724C44BB9D4524F5BB32E1EB1CCC131944AB49B0EE98A7B062853AC0B50A1D2C97CE3C6B9E419D9E472D435D0AEE7A00F4F12A8A5571A3F93C675EF41B45DF2EF6D9070E6F486E4D06E84A7914A44B8ADCEDF6AAAD41B6A30B9E37655AD1C744506B529C6D8A94D50EADA55512806F7D89A453121118565D6BF4B6D2A1CE8EBD470E74A23CEBF71749CE4AA519E1C88B5881972A578BCDD82C624E8159393F57EEB2723A17F5D1D3880AEECBA64CCBBE013A3CCE209497D10A09EC7E23685FA45431ADB5DA6D48506C705BF5E2D7C619B55BE5699E4AD992DCCCC5CE77327F14A41CDB7DFCF37BCFF5183768B02937A864C54548600F51B0686F2C4B36A3A6FB118F405F669E3987FF58450CBAAC6155E84980EB0D2479C239E95A8E8E835B22C2A707D1FDEA0A4DCAF31B818D598D54B87053BAEE641C88D96F009382580480E91FD7664CA8D5D93EEACE8D0890EE28011EDCC82DAF3D06C652FFF65540BCAC2BCA37B9368831D3B5A85865885390FD9EC1BA0F961CA62B58A9CD72AFCB75B092729AA4A59A9700F4F0BE6E905074B6939C3ED1C622E5BF82348D21D5B4F26355144872568B8489A93C622EBCCB29889A53BD46226FEE0CBD577E6AE6A827CE62DA02E45F3BB0ED749923F87375C4BD36277D4B3E9A07B9475610D44716E5BF3149745B94C90C2CE6D652D31A78D5D6E1253837FAFB9DA4928D8265FE3FB8E95B81B2CEF813FAE0B4CC52BCCDBD2433F21F860728CB1E293513522090CF4EADEA24AC466B8277D094E2F588056B90271876773F52707824708AB17FFFD457A1D5CD2AFF9CDC140ACDB76A256F4147C114144EDF2873DDDCEEC40960827E5F8E79F9589EAD43B65D343AB1314A2847775DA43C74421A42D35D0CA365DB1B6DD2128F9304F32EB343E00183C73F9008CEF0F41034A4A9F3C9565C5A8FCBF2ED1ECCC946102A14BED3598E20AD7F70A476B017480B9E099B84430692A720EE5F7A39BA57B33C3D42ADB32008F141F110EE1BA24B2E42E00354F4B2778CAC6201F3A0E71B1C38E80DC39C5153830F55A0A6310D0A3E4F58342747E10CD6DB379221E109562940F0C88EF0A1B12C66B53CA436E21AC73F3C3E1A17E3819A7D306592F4C162CABD29642931F5C1596D33DC13A1AE263823F3E7D008D5D1C682640B08ECA23A940C329CCC68F7784FB8FE84B8F0D361CD1C6B85442D7B2D66AE254EB35CFA35F70A3AC3A348E0B8FC883C1DD86D92E0E389E7F86BF1F5D6004BC83EF0337A93DEF6085202BEA49CCCC2415BE5C023B44747E0CEB13FD20326E4AC4EAC52DD5264D682784A9FE6D6C9F188282C776E449F9A28055F68F931699AF66294ED6BC091946348688B0B0CD815E889AE0CFA3DC3080B65644DB9542CCE6F729BCF411B81D9185FDFD309C3A792A096B1E7F74AA7A2EA419DFA27AC83F0A8FFE94A52391287F15C412A12FE0005B7590F0A9531FF1331D66F347B4F089BBF3FD8D1A0EDD2110C88430D21B0DC5C935855D2E91B997924384E78792EF21C6D25AD6279EC255D2A3B6D03EA62BDFBA9825C22541200625510B2780256C4443A13A1EDFC3D5177EAAF242BE6DA6B06010AB692DBDEA8FE3DB098181D5B536A313117369D73500E6449AFFDC0751F2321950DF3F71AE130D06DE1D672AA6ADD71629797E11BE64F10D5973E405A6F0C4E0F3B5E945AA65E10F050552D5B4A3EBB511093DB159A86C4E80C06F5F021306D564041175682D2B421C3B28D4A2590748060E9C5F9B997932362D572BA546DB92E14B8199CDA79944AA09BB5785C772FBF3021A1BFB3B88785BEA9137D1A8F038716DAC6873739E9A5CACA191549B6582375646874069E90D6AB9ABFA1F5B12E0B7F1415FCFF5C587D8765AEF696CF4F5B5B3C9C58B226C2A09F851F85A2CA6D93039E49044440DBB9FE594266B0EC51CEC2066DAE6CD79F9A6EB5E153B64BF777E39F9BBA7A36ADECFE3A4DF7ABC8F13770879DBCF0D27F7045A478E0077791BB6AAF283BE3A933FEAB67B05F6769EC8B0C319C5CB01DC37820F86C91C5408D237036888C43F5F6181B0A676CA97CF0C6B3FEDB58ECB0B8C4BA1051A62213660AAB4AC774963031DE6D87E25E3F91C77692A579BA2741D1474BFC195C2BF4DE3A0A243124FCA0BB14B9F6E941E9E13D7BD3EA1383D49896F139DC519F81011A2E41987EAEC5565401025843076F3B4DBED45F02B6391FE66B2A5DBB93817FBCF14969B11BD1A1336EAFB21D7D476FF4B99AE28DA5BFB311945944226F88789B6BAEB3475AF6867C106319C21543A6C40C3390040CB4F8CD5A3EA1FCFE529E7E9F49B38C4687F5462611155627A5FDEC89F9BAB2B64A2B2EF4A814000C100A8CF385A0D52BAA11A08604E94047C499161447FBDBB45B724A891BCB07F4E855666F1CDF333B201E955E3F9B4238599C5F5D608CCD8E320C14F5E99000CB27D0FD9293ABA89F859F860E2652405A946D46FA9EA578DA743EFAA031C8C72B9FCD31E23E27F438773CF611862DD0C75B23B6B927511DE7EFC028F0C457FBA427E2E6F84C4B840A259E3BA280EB7EB30E1037914E12CA056A55588017D10B3D7D69E807ABA333CAB7E1A02B32105D52B08521C4EA65DCC6D3F1EAFD0A599B3407C78CB3BFBE56015D8905F6F612AA6160693F56F9763BA181B4B453C940AFBFBEECCE5D049F44A3F2AF85F16270BE94B65C17A2D98F90D743923DAAE42A6052CFEB3446602686C468AFF1C6522D5E487A051FAAD4C70CD8E24DA86627098A1BCEED93E0D59A1485B86E36BB10710E0A1E9958F0600C24DADE7022F6FDA984673BA9E7A41F7DE0008DB5F0A73DFFEF76CF66D105812A60DF8840D2DE3D4EC27C660AB70DEADD84CBBB16B7E6E6DD40BA2032BAA5E3D380F6252802814E68109194917A4CE0BD44C4FA371EDF2516DE00B884A315178A218C75B006ED93F4D8D04A165EBD736B5EF17E8220D943E8FA83514B16625E4C1E557D85167BD2F8EFE95168EA691FB2F458BD8F428BDE1F23E56C12A2814D65EC4172EF289C60370478AC2A5150D267C77BBF4E2697DC289A391B417FA741A3DD275705888988AD4676F1D20263502C214C9368342015DC9051EF0EDE9CF8E038707EBDC4128E872DE3F7772CE97BA1FE288D31A3CAE2B3894FD7A22B2CF629771B1DFA0468ED7DF0E6AC206D3FE176845EB29740A8AE60EF9C161F3787FE32620421324169DA731B7CDB518468AACA9F9B0605AF4A21E5F7EC859F21408F610373652ED84DD4DA23BE392E0B7E6805FFF8A310AF53CDA74FC72BD2A2FA152D929D628FE423118DCCCB6A92E19E0276AED6C67B2A1F13AEFD9191640741E10124E1905B913830A0FE4311F3586F91028FEE10609D1086299AFB678BC36AE2AE852BC2D531A5B5F202ACF8AD4C092FA0F18F9C8D7D81F553EC2E9AA7C7BB455828539DEB6DC8BA1F953467F427F08880442C2CD4B522BA564C233E8E0BC2F78F255138EAD9E162E2ED9DBB4493B209C7F66643A250DD51F396957E17CF05C5BAD11EAF59B1FBDAC915ADFEBD4893FF6EB18AB136492A7B5C87BE9DF35AAA68A14120242676E931284527999C7E6FB32A586215DAF09C308D28822ABF2864E36782F37528A6968DE5FFBC2FB59E230EA93BD7B4409C4AF2A0F1F09487B8196F6C458AD4B29D9113D7A00FADD65226A227EB407833DE9E891D62817A90BEC1E5237DD27F9FF4834245A9F15A9C3EC31740C6C7283C9DC695E784C979E2E6E070D972320720C826E</crypted>
		<attribute name="TypeCodeCheckSumString" value="93C5"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="47F1"></attribute>
		<ExternalToolsOnly>
			<inputParameters>
				<variables name="COMANDA" typeName="INT">
					<attribute name="PositionPin" value="1"></attribute>
				</variables>
				<variables name="TIPO_ENT" typeName="INT">
					<attribute name="PositionPin" value="3"></attribute>
				</variables>
				<variables name="LONG_ENT" typeName="INT">
					<attribute name="PositionPin" value="4"></attribute>
				</variables>
				<variables name="LONG_COL" typeName="INT">
					<attribute name="PositionPin" value="5"></attribute>
				</variables>
				<variables name="BUF_ENTR" typeName="intarraycola">
					<attribute name="PositionPin" value="2"></attribute>
				</variables>
			</inputParameters>
			<outputParameters>
				<variables name="PUNTERO" typeName="INT">
					<attribute name="PositionPin" value="1"></attribute>
				</variables>
				<variables name="TIPO_SAL" typeName="INT">
					<attribute name="PositionPin" value="2"></attribute>
				</variables>
				<variables name="LONG_SAL" typeName="INT">
					<attribute name="PositionPin" value="3"></attribute>
				</variables>
				<variables name="CABECERA" typeName="INT">
					<attribute name="PositionPin" value="5"></attribute>
				</variables>
				<variables name="BORRA" typeName="INT">
					<attribute name="PositionPin" value="6"></attribute>
				</variables>
				<variables name="PERDIDOS" typeName="INT">
					<attribute name="PositionPin" value="7"></attribute>
				</variables>
				<variables name="AL_BUF" typeName="BOOL">
					<attribute name="PositionPin" value="8"></attribute>
				</variables>
			</outputParameters>
			<publicLocalVariables>
				<variables name="buf_sal" typeName="intarraycola"></variables>
			</publicLocalVariables>
		</ExternalToolsOnly>
	</FBSource>
	<DDTSource DDTName="colacortaarray" version="2.00" dateTime="dt#2009-03-16-15:13:31">
		<attribute name="TypeSignatureCheckSumString" value="ABF3"></attribute>
		<array>ARRAY[0..4000] OF INT</array>
	</DDTSource>
	<FBSource nameOfFBType="LECTURAS_MB_READ_VAR_M340" version="0.06" dateTime="dt#2022-05-17-13:40:28">
		<attribute name="TypeProtectionLevel" value="2#0000_0000"></attribute>
		<attribute name="TypeCodeCheckSumString" value="8A66"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="A451"></attribute>
		<inputParameters>
			<variables name="NUMERO_LECTURAS" typeName="INT">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="NUMERO_REINTENTOS" typeName="INT">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="NUEVO_COMIENZO_INDEXADO" typeName="INT">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="HABILITAR" typeName="BOOL">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
		</inputParameters>
		<inOutParameters>
			<variables name="ARRAY_LECTURAS" typeName="ARRAY[1..100] OF Lecturas_Read_Var">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="ARRAY_GEST" typeName="ARRAY[1..4] OF INT">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
			<variables name="MODIFICAR_PETICION" typeName="BOOL">
				<attribute name="PositionPin" value="7"></attribute>
			</variables>
			<variables name="CONTAJE_INDEX_READ_VAR" typeName="INT">
				<attribute name="PositionPin" value="8"></attribute>
			</variables>
		</inOutParameters>
		<outputParameters>
			<variables name="BUSY" typeName="BOOL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="INDEX" typeName="INT">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
		</outputParameters>
		<privateLocalVariables>
			<variables name="COM_OK" typeName="EBOOL"></variables>
		</privateLocalVariables>
		<FBProgram name="Comunicacion">
			<STSource>com_ok:=ARRAY_GEST[1].0 &amp; NUMERO_LECTURAS&gt;0;
 
IF FE (COM_OK) THEN
	IF ARRAY_GEST[2]=0 THEN
		ARRAY_LECTURAS[INDEX].Reintentos:=NUMERO_REINTENTOS;
		ARRAY_LECTURAS[INDEX].Fallo:=FALSE;
		ARRAY_LECTURAS[INDEX].Codigo_fallo:=0;		
		IF INDEX&gt;=NUMERO_LECTURAS THEN 
			INDEX:=1;
                	CONTAJE_INDEX_READ_VAR:=CONTAJE_INDEX_READ_VAR+1;
		ELSE
			INC (INDEX);
                	CONTAJE_INDEX_READ_VAR:=CONTAJE_INDEX_READ_VAR+1;
		END_IF;

		IF MODIFICAR_PETICION THEN
	        	INDEX:=NUEVO_COMIENZO_INDEXADO;
                	CONTAJE_INDEX_READ_VAR:=0;
			MODIFICAR_PETICION:=0;
		END_IF;
	ELSE 
		IF ARRAY_LECTURAS[INDEX].Reintentos=0 THEN
			ARRAY_LECTURAS[INDEX].Fallo:=TRUE;
			ARRAY_LECTURAS[INDEX].Codigo_fallo:=INT_TO_BYTE (ARRAY_GEST[2]);
			IF INDEX&gt;=NUMERO_LECTURAS THEN
				INDEX:=1;
                        	CONTAJE_INDEX_READ_VAR:=CONTAJE_INDEX_READ_VAR+1;
			ELSE
				INC (INDEX);
                        	CONTAJE_INDEX_READ_VAR:=CONTAJE_INDEX_READ_VAR+1;
			END_IF;	
		ELSE
			DEC (ARRAY_LECTURAS[INDEX].Reintentos);
		END_IF;

		IF MODIFICAR_PETICION THEN
			ARRAY_LECTURAS[INDEX].Reintentos:=NUMERO_REINTENTOS;
	        	INDEX:=NUEVO_COMIENZO_INDEXADO;
                	CONTAJE_INDEX_READ_VAR:=0;
			MODIFICAR_PETICION:=0;
		END_IF;
	END_IF;
END_IF;

BUSY:=com_ok;
</STSource>
		</FBProgram>
		<FBProgram name="Analizador">
			<STSource>IF NOT ARRAY_GEST[1].0 &amp; NUMERO_LECTURAS&gt;0 &amp; HABILITAR THEN
	READ_VAR (ADR := ADDM(ARRAY_LECTURAS[INDEX].Terminal),
	          OBJ := ARRAY_LECTURAS[INDEX].Objeto,
	          NUM := ARRAY_LECTURAS[INDEX].Dir_inicial_terminal,
	          NB := ARRAY_LECTURAS[INDEX].Num_palabras,
	          GEST := ARRAY_GEST,
	          RECP =&gt; ARRAY_LECTURAS[INDEX].Array_destino);
END_IF;
</STSource>
		</FBProgram>
	</FBSource>
</PGMExchangeFile>
